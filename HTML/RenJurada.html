<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaración Jurada - Menor de Edad</title>
    <!-- Agregar jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        
        .header .subtitle {
            font-size: 16px;
            font-weight: normal;
            margin-bottom: 5px;
        }
        
        .institution-name {
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .form-section {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
        }
        
        .form-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
            margin-right: 20px;
            margin-bottom: 15px;
        }
        
        .form-group:last-child {
            margin-right: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .declaration-text {
            background-color: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 20px 0;
            font-size: 15px;
        }
        
        .checkbox-group {
            margin: 15px 0;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .checkbox-group label {
            display: inline-block;
            font-weight: normal;
        }
        
        .signature-section {
            padding: 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            margin-top: 20px;
        }
        
        .signature-box {
            border: 1px dashed #aaa;
            height: 100px;
            margin-top: 10px;
            padding: 10px;
            background-color: white;
            position: relative;
            cursor: crosshair;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 180px;
        }
        
        .btn-reset {
            background-color: #e9ecef;
            color: #495057;
        }
        
        .btn-reset:hover {
            background-color: #dee2e6;
        }
        
        .btn-submit {
            background-color: #2c3e50;
            color: white;
        }
        
        .btn-submit:hover {
            background-color: #1a252f;
        }
        
        .btn-pdf {
            background-color: #9b59b6;
            color: white;
        }
        
        .btn-pdf:hover {
            background-color: #8e44ad;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .page-number {
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .signature-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        @media print {
            .buttons, .btn {
                display: none;
            }
            
            body {
                background-color: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
            }
        }
        
        @media (max-width: 768px) {
            .form-group {
                min-width: 100%;
                margin-right: 0;
            }
            
            .form-section {
                padding: 15px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>P.B.U Ministerio de Educación</h1>
            <div class="subtitle">Dirección Regional</div>
            <h2>DECLARACIÓN JURADA DE DOCUMENTOS</h2>
            <div>(POSTULANTE MENOR DE EDAD)</div>
        </div>
        
        <div class="institution-name">
            Instituto de Educación Superior Tecnológico Público<br>
            María Rosario Araoz Pinto
        </div>
        
        <form id="declaracionForm">
            <!-- Página 1 -->
            <div class="form-section">
                <div class="page-number">Página 1 de 3</div>
                <h3 class="form-title">DATOS DEL APODERADO Y POSTULANTE</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="nombresApoderado">Nombres del apoderado <span class="required">*</span></label>
                        <input type="text" id="nombresApoderado" name="nombresApoderado" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="apellidosApoderado">Apellidos del apoderado <span class="required">*</span></label>
                        <input type="text" id="apellidosApoderado" name="apellidosApoderado" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dniApoderado">DNI del apoderado <span class="required">*</span></label>
                        <input type="text" id="dniApoderado" name="dniApoderado" required pattern="[0-9]{8}">
                    </div>
                    
                    <div class="form-group">
                        <label for="domicilioApoderado">Domicilio <span class="required">*</span></label>
                        <input type="text" id="domicilioApoderado" name="domicilioApoderado" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="parentesco">Parentesco con el postulante <span class="required">*</span></label>
                        <select id="parentesco" name="parentesco" required>
                            <option value="">Seleccione...</option>
                            <option value="padre">Padre</option>
                            <option value="madre">Madre</option>
                            <option value="apoderado">Apoderado</option>
                            <option value="tutor">Tutor</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-title" style="margin-top: 30px;">DATOS DEL POSTULANTE (MENOR DE EDAD)</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="nombresPostulante">Nombres del postulante <span class="required">*</span></label>
                        <input type="text" id="nombresPostulante" name="nombresPostulante" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="apellidosPostulante">Apellidos del postulante <span class="required">*</span></label>
                        <input type="text" id="apellidosPostulante" name="apellidosPostulante" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dniPostulante">DNI del postulante <span class="required">*</span></label>
                        <input type="text" id="dniPostulante" name="dniPostulante" required pattern="[0-9]{8}">
                    </div>
                </div>
            </div>
            
            <!-- Página 2 -->
            <div class="form-section">
                <div class="page-number">Página 2 de 3</div>
                <h3 class="form-title">DECLARACIÓN BAJO JURAMENTO</h3>
                
                <div class="declaration-text">
                    <p><strong>DECLARO BAJO JURAMENTO QUE:</strong></p>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion1" name="declaracion1" required>
                        <label for="declaracion1">I. Mis datos personales y los de mi hijo(a) o apoderante consignados en la presente declaración jurada y en la inscripción vía web de la IESTP María Rosario Araoz Pinto son los mismos que figuran en los documentos de identidad (DNI, pasaporte o carné de extranjería).</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion2" name="declaracion2" required>
                        <label for="declaracion2">II. Los documentos proporcionados virtualmente en la inscripción son fidedignos a los originales y no tienen ninguna modificación o alteración.</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion3" name="declaracion3" required>
                        <label for="declaracion3">III. Mi hijo(a) o apoderante ha culminado satisfactoriamente sus estudios de nivel secundaria en la Institución Educativa:</label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="institucionEducativa">Institución Educativa <span class="required">*</span></label>
                        <input type="text" id="institucionEducativa" name="institucionEducativa" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="ciudad">Ciudad <span class="required">*</span></label>
                        <input type="text" id="ciudad" name="ciudad" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="region">Región <span class="required">*</span></label>
                        <input type="text" id="region" name="region" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="provincia">Provincia <span class="required">*</span></label>
                        <input type="text" id="provincia" name="provincia" required>
                    </div>
                </div>
                
                <div class="declaration-text">
                    <p>...y que por motivos de la emergencia sanitaria a nivel nacional, no es posible tramitar el certificado de estudios y en caso de ocupar una vacante en el proceso de Admisión no presencial me comprometo a regularizar la entrega de dichos certificados en original de forma virtual (o física si en caso termina la emergencia sanitaria). Caso contrario, me someto a las disposiciones que la autoridad del IESTP María Rosario Araoz Pinto y el equipo técnico de admisión estime pertinente.</p>
                </div>
            </div>
            
            <!-- Página 3 -->
            <div class="form-section">
                <div class="page-number">Página 3 de 3</div>
                
                <div class="warning">
                    <strong>ADVERTENCIA:</strong> Comprobarse la falsedad de la información registrada al momento de mi inscripción. De faltar a la verdad en esta declaración me sujeto a los alcances de lo establecido en el artículo 411° del Código Penal y acepto la anulación del examen de admisión del TESTP María Rosario Araoz Pinto, sin lugar a reclamo.
                </div>
                
                <div class="signature-section">
                    <h3 class="form-title">FIRMA DEL APODERADO</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fecha">Fecha <span class="required">*</span></label>
                            <input type="date" id="fecha" name="fecha" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="dniFirma">DNI del apoderado (para verificación) <span class="required">*</span></label>
                            <input type="text" id="dniFirma" name="dniFirma" required pattern="[0-9]{8}">
                        </div>
                    </div>
                    
                    <label>Firma del apoderado <span class="required">*</span></label>
                    <div class="signature-box" id="signatureBox">
                        <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                        <p id="signaturePlaceholder">Firma aquí o en el espacio destinado para tal efecto</p>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <button type="button" id="clearSignature" class="btn btn-reset" style="padding: 8px 16px; font-size: 14px;">Limpiar firma</button>
                    </div>
                    
                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="huellaDigital">Huella digital (índice derecho)</label>
                            <input type="text" id="huellaDigital" name="huellaDigital" placeholder="Se registrará físicamente">
                        </div>
                    </div>
                </div>
                
                <div class="warning" style="margin-top: 20px;">
                    <strong>Artículo 411° del Código Penal:</strong> El que, en un procedimiento administrativo, hace una falsa declaración en relación a hechos o circunstancias que le corresponde probar, violando la presunción de veracidad establecida por ley, será reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro años.
                </div>
            </div>
            
            <div class="buttons">
                <button type="reset" class="btn btn-reset">Limpiar formulario</button>
                <button type="button" class="btn btn-pdf" id="btnPdf">Descargar PDF</button>
                <button type="submit" class="btn btn-submit">Enviar declaración jurada</button>
            </div>
        </form>
    </div>

    <script>
        // Cargar jsPDF
        const { jsPDF } = window.jspdf;
        
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('declaracionForm');
            const signatureBox = document.getElementById('signatureBox');
            const signatureCanvas = document.getElementById('signatureCanvas');
            const signaturePlaceholder = document.getElementById('signaturePlaceholder');
            const clearSignatureBtn = document.getElementById('clearSignature');
            const btnPdf = document.getElementById('btnPdf');
            
            // Configurar canvas para firma
            const ctx = signatureCanvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // Ajustar tamaño del canvas
            function resizeCanvas() {
                const box = signatureBox.getBoundingClientRect();
                signatureCanvas.width = box.width;
                signatureCanvas.height = box.height;
                
                // Configurar estilo de dibujo
                ctx.lineWidth = 2;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000000';
            }
            
            // Inicializar canvas
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Eventos para dibujar en el canvas
            signatureCanvas.addEventListener('mousedown', function(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
                signaturePlaceholder.style.display = 'none';
            });
            
            signatureCanvas.addEventListener('mousemove', function(e) {
                if (!isDrawing) return;
                e.preventDefault();
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });
            
            signatureCanvas.addEventListener('mouseup', function() {
                isDrawing = false;
            });
            
            signatureCanvas.addEventListener('mouseout', function() {
                isDrawing = false;
            });
            
            // Eventos táctiles para dispositivos móviles
            signatureCanvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = signatureCanvas.getBoundingClientRect();
                isDrawing = true;
                [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
                signaturePlaceholder.style.display = 'none';
            });
            
            signatureCanvas.addEventListener('touchmove', function(e) {
                if (!isDrawing) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const rect = signatureCanvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            });
            
            signatureCanvas.addEventListener('touchend', function() {
                isDrawing = false;
            });
            
            // Limpiar firma
            clearSignatureBtn.addEventListener('click', function() {
                ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                signaturePlaceholder.style.display = 'block';
            });
            
            // Configurar fecha actual por defecto
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Botón para descargar PDF
            btnPdf.addEventListener('click', function() {
                if (!validarFormulario()) {
                    return;
                }
                
                // Verificar que haya firma
                const signatureDots = signaturePlaceholder.style.display === 'none';
                if (!signatureDots) {
                    if (!confirm('No ha proporcionado su firma. ¿Desea continuar de todos modos?')) {
                        return;
                    }
                }
                
                generarPDF();
            });
            
            // Función para generar PDF
            function generarPDF() {
                try {
                    // Crear un nuevo documento PDF
                    const doc = new jsPDF('p', 'mm', 'a4');
                    
                    // Configuración de márgenes
                    const marginLeft = 15;
                    const marginRight = 15;
                    const pageWidth = 210;
                    const pageHeight = 297;
                    let yPosition = 20;
                    
                    // Obtener datos del formulario
                    const nombresApoderado = document.getElementById('nombresApoderado').value;
                    const apellidosApoderado = document.getElementById('apellidosApoderado').value;
                    const dniApoderado = document.getElementById('dniApoderado').value;
                    const domicilioApoderado = document.getElementById('domicilioApoderado').value;
                    const parentesco = document.getElementById('parentesco').value;
                    const nombresPostulante = document.getElementById('nombresPostulante').value;
                    const apellidosPostulante = document.getElementById('apellidosPostulante').value;
                    const dniPostulante = document.getElementById('dniPostulante').value;
                    const institucionEducativa = document.getElementById('institucionEducativa').value;
                    const ciudad = document.getElementById('ciudad').value;
                    const region = document.getElementById('region').value;
                    const provincia = document.getElementById('provincia').value;
                    const fecha = document.getElementById('fecha').value;
                    const dniFirma = document.getElementById('dniFirma').value;
                    const huellaDigital = document.getElementById('huellaDigital').value;
                    
                    // Configurar fuente y colores
                    doc.setFont("helvetica", "normal");
                    
                    // ========== ENCABEZADO INSTITUCIONAL ==========
                    doc.setFontSize(14);
                    doc.setFont("helvetica", "bold");
                    doc.setTextColor(44, 62, 80);
                    doc.text("P.B.U Ministerio de Educación", pageWidth / 2, yPosition, { align: "center" });
                    yPosition += 6;
                    
                    doc.setFontSize(12);
                    doc.text("Dirección Regional", pageWidth / 2, yPosition, { align: "center" });
                    yPosition += 8;
                    
                    doc.setFontSize(16);
                    doc.text("DECLARACIÓN JURADA DE DOCUMENTOS", pageWidth / 2, yPosition, { align: "center" });
                    yPosition += 8;
                    
                    doc.setFontSize(14);
                    doc.text("(POSTULANTE MENOR DE EDAD)", pageWidth / 2, yPosition, { align: "center" });
                    
                    yPosition += 10;
                    
                    // Institución
                    doc.setFontSize(12);
                    doc.text("Instituto de Educación Superior Tecnológico Público", pageWidth / 2, yPosition, { align: "center" });
                    yPosition += 6;
                    doc.text("María Rosario Araoz Pinto", pageWidth / 2, yPosition, { align: "center" });
                    
                    yPosition += 15;
                    
                    // ========== PÁGINA 1: DATOS DEL APODERADO Y POSTULANTE ==========
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text("DATOS DEL APODERADO Y POSTULANTE", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    // Datos del apoderado
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "bold");
                    doc.text("Apoderado:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    const nombreApoderado = `${nombresApoderado} ${apellidosApoderado}`;
                    doc.text(nombreApoderado, marginLeft + 30, yPosition);
                    
                    yPosition += 7;
                    
                    doc.setFont("helvetica", "bold");
                    doc.text("DNI:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    doc.text(dniApoderado, marginLeft + 15, yPosition);
                    
                    doc.setFont("helvetica", "bold");
                    doc.text("Domicilio:", marginLeft + 80, yPosition);
                    doc.setFont("helvetica", "normal");
                    const domicilioLines = doc.splitTextToSize(domicilioApoderado, pageWidth - marginLeft - marginRight - 90);
                    doc.text(domicilioLines, marginLeft + 105, yPosition);
                    yPosition += domicilioLines.length * 6;
                    
                    yPosition += 5;
                    
                    doc.setFont("helvetica", "bold");
                    doc.text("Parentesco:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    const parentescoTexto = parentesco.charAt(0).toUpperCase() + parentesco.slice(1);
                    doc.text(parentescoTexto, marginLeft + 30, yPosition);
                    
                    yPosition += 15;
                    
                    // Datos del postulante
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text("DATOS DEL POSTULANTE (MENOR DE EDAD)", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "bold");
                    doc.text("Nombre completo:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    const nombrePostulante = `${nombresPostulante} ${apellidosPostulante}`;
                    doc.text(nombrePostulante, marginLeft + 40, yPosition);
                    
                    yPosition += 7;
                    
                    doc.setFont("helvetica", "bold");
                    doc.text("DNI:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    doc.text(dniPostulante, marginLeft + 15, yPosition);
                    
                    yPosition += 15;
                    
                    // ========== PÁGINA 2: DECLARACIÓN BAJO JURAMENTO ==========
                    // Nueva página si es necesario
                    if (yPosition > pageHeight - 100) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text("DECLARACIÓN BAJO JURAMENTO", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "bold");
                    doc.text("DECLARO BAJO JURAMENTO QUE:", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    // Declaración I
                    doc.setFont("helvetica", "normal");
                    const declaracion1 = "I. Mis datos personales y los de mi hijo(a) o apoderante consignados en la presente declaración jurada y en la inscripción vía web de la IESTP María Rosario Araoz Pinto son los mismos que figuran en los documentos de identidad (DNI, pasaporte o carné de extranjería).";
                    const lines1 = doc.splitTextToSize(declaracion1, pageWidth - marginLeft - marginRight);
                    doc.text(lines1, marginLeft, yPosition);
                    
                    yPosition += lines1.length * 6 + 5;
                    doc.text("✓ Confirmo", marginLeft + 10, yPosition);
                    
                    yPosition += 10;
                    
                    // Declaración II
                    const declaracion2 = "II. Los documentos proporcionados virtualmente en la inscripción son fidedignos a los originales y no tienen ninguna modificación o alteración.";
                    const lines2 = doc.splitTextToSize(declaracion2, pageWidth - marginLeft - marginRight);
                    doc.text(lines2, marginLeft, yPosition);
                    
                    yPosition += lines2.length * 6 + 5;
                    doc.text("✓ Confirmo", marginLeft + 10, yPosition);
                    
                    yPosition += 10;
                    
                    // Declaración III
                    const declaracion3 = "III. Mi hijo(a) o apoderante ha culminado satisfactoriamente sus estudios de nivel secundaria en la Institución Educativa:";
                    const lines3 = doc.splitTextToSize(declaracion3, pageWidth - marginLeft - marginRight);
                    doc.text(lines3, marginLeft, yPosition);
                    
                    yPosition += lines3.length * 6 + 5;
                    doc.text("✓ Confirmo", marginLeft + 10, yPosition);
                    
                    yPosition += 15;
                    
                    // Datos de la institución educativa
                    doc.text(`Institución Educativa: ${institucionEducativa}`, marginLeft, yPosition);
                    
                    yPosition += 8;
                    doc.text(`Ciudad: ${ciudad}`, marginLeft, yPosition);
                    
                    yPosition += 8;
                    doc.text(`Región: ${region}`, marginLeft, yPosition);
                    
                    yPosition += 8;
                    doc.text(`Provincia: ${provincia}`, marginLeft, yPosition);
                    
                    yPosition += 15;
                    
                    // Texto sobre emergencia sanitaria
                    const emergenciaTexto = "...y que por motivos de la emergencia sanitaria a nivel nacional, no es posible tramitar el certificado de estudios y en caso de ocupar una vacante en el proceso de Admisión no presencial me comprometo a regularizar la entrega de dichos certificados en original de forma virtual (o física si en caso termina la emergencia sanitaria). Caso contrario, me someto a las disposiciones que la autoridad del IESTP María Rosario Araoz Pinto y el equipo técnico de admisión estime pertinente.";
                    const emergenciaLines = doc.splitTextToSize(emergenciaTexto, pageWidth - marginLeft - marginRight);
                    doc.text(emergenciaLines, marginLeft, yPosition);
                    yPosition += emergenciaLines.length * 6 + 15;
                    
                    // ========== PÁGINA 3: FIRMA Y ADVERTENCIAS ==========
                    // Nueva página
                    doc.addPage();
                    yPosition = 20;
                    
                    // Advertencia
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "bold");
                    doc.text("ADVERTENCIA:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    const advertenciaTexto = "Comprobarse la falsedad de la información registrada al momento de mi inscripción. De faltar a la verdad en esta declaración me sujeto a los alcances de lo establecido en el artículo 411° del Código Penal y acepto la anulación del examen de admisión del TESTP María Rosario Araoz Pinto, sin lugar a reclamo.";
                    const advertenciaLines = doc.splitTextToSize(advertenciaTexto, pageWidth - marginLeft - marginRight);
                    doc.text(advertenciaLines, marginLeft + 10, yPosition + 5);
                    
                    yPosition += advertenciaLines.length * 6 + 20;
                    
                    // Sección de firma
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text("FIRMA DEL APODERADO", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    // Fecha
                    const fechaFormateada = new Date(fecha).toLocaleDateString('es-ES');
                    doc.setFontSize(11);
                    doc.setFont("helvetica", "normal");
                    doc.text(`Fecha: ${fechaFormateada}`, marginLeft, yPosition);
                    
                    yPosition += 8;
                    doc.text(`DNI del apoderado (para verificación): ${dniFirma}`, marginLeft, yPosition);
                    
                    yPosition += 15;
                    
                    doc.text("Firma del apoderado:", marginLeft, yPosition);
                    
                    yPosition += 10;
                    
                    // Dibujar espacio para firma
                    doc.setDrawColor(0);
                    doc.setLineWidth(0.5);
                    doc.rect(marginLeft, yPosition, 80, 25);
                    
                    // Agregar la firma del canvas si existe
                    const signatureDataUrl = signatureCanvas.toDataURL();
                    if (signatureDataUrl && signaturePlaceholder.style.display === 'none') {
                        try {
                            doc.addImage(signatureDataUrl, 'PNG', marginLeft + 2, yPosition + 2, 76, 21);
                        } catch (error) {
                            console.error("Error al agregar firma:", error);
                        }
                    }
                    
                    yPosition += 35;
                    
                    // Huella digital
                    doc.text("Huella digital (índice derecho):", marginLeft, yPosition);
                    doc.text(huellaDigital || "Se registrará físicamente", marginLeft + 50, yPosition);
                    
                    yPosition += 20;
                    
                    // Artículo 411° del Código Penal
                    doc.setFont("helvetica", "bold");
                    doc.text("Artículo 411° del Código Penal:", marginLeft, yPosition);
                    doc.setFont("helvetica", "normal");
                    const articuloTexto = "El que, en un procedimiento administrativo, hace una falsa declaración en relación a hechos o circunstancias que le corresponde probar, violando la presunción de veracidad establecida por ley, será reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro años.";
                    const articuloLines = doc.splitTextToSize(articuloTexto, pageWidth - marginLeft - marginRight);
                    doc.text(articuloLines, marginLeft, yPosition + 5);
                    
                    // Pie de página
                    const footerY = pageHeight - 20;
                    doc.setFontSize(9);
                    doc.setTextColor(100, 100, 100);
                    doc.text("Documento generado el " + new Date().toLocaleDateString('es-ES'), pageWidth / 2, footerY, { align: "center" });
                    doc.text("Declaración Jurada de Documentos - Postulante Menor de Edad", pageWidth / 2, footerY + 5, { align: "center" });
                    
                    // Generar nombre del archivo
                    const nombreArchivo = `Declaracion_Jurada_${apellidosApoderado}_${dniApoderado}.pdf`;
                    
                    // Guardar PDF
                    doc.save(nombreArchivo);
                    
                    alert(`PDF generado exitosamente: ${nombreArchivo}`);
                    
                } catch (error) {
                    console.error("Error al generar PDF:", error);
                    alert("Ocurrió un error al generar el PDF. Por favor, intente nuevamente.");
                }
            }
            
            // Función de validación
            function validarFormulario() {
                // Validar campos obligatorios
                const camposObligatorios = [
                    'nombresApoderado',
                    'apellidosApoderado',
                    'dniApoderado',
                    'domicilioApoderado',
                    'parentesco',
                    'nombresPostulante',
                    'apellidosPostulante',
                    'dniPostulante',
                    'institucionEducativa',
                    'ciudad',
                    'region',
                    'provincia',
                    'fecha',
                    'dniFirma'
                ];
                
                let valido = true;
                
                camposObligatorios.forEach(campo => {
                    const elemento = document.getElementById(campo);
                    if (!elemento.value.trim()) {
                        valido = false;
                        elemento.style.borderColor = '#e74c3c';
                        elemento.style.backgroundColor = '#ffe6e6';
                    } else {
                        elemento.style.borderColor = '';
                        elemento.style.backgroundColor = '';
                    }
                });
                
                // Validar checkboxes
                const declaracion1 = document.getElementById('declaracion1');
                const declaracion2 = document.getElementById('declaracion2');
                const declaracion3 = document.getElementById('declaracion3');
                
                if (!declaracion1.checked || !declaracion2.checked || !declaracion3.checked) {
                    valido = false;
                    alert('Debe aceptar todas las declaraciones bajo juramento.');
                }
                
                // Validar formato de DNI
                const dniRegex = /^[0-9]{8}$/;
                const dniApoderado = document.getElementById('dniApoderado').value;
                const dniPostulante = document.getElementById('dniPostulante').value;
                const dniFirmaVal = document.getElementById('dniFirma').value;
                
                if (dniApoderado && !dniRegex.test(dniApoderado)) {
                    valido = false;
                    alert('El DNI del apoderado debe tener 8 dígitos numéricos.');
                }
                
                if (dniPostulante && !dniRegex.test(dniPostulante)) {
                    valido = false;
                    alert('El DNI del postulante debe tener 8 dígitos numéricos.');
                }
                
                if (dniFirmaVal && !dniRegex.test(dniFirmaVal)) {
                    valido = false;
                    alert('El DNI de verificación debe tener 8 dígitos numéricos.');
                }
                
                if (!valido) {
                    alert('Por favor complete todos los campos requeridos correctamente.');
                    return false;
                }
                
                return true;
            }
            
            // Validación del formulario al enviar
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!validarFormulario()) {
                    return;
                }
                
                // Verificar que haya firma
                const signatureDots = signaturePlaceholder.style.display === 'none';
                if (!signatureDots) {
                    if (!confirm('No ha proporcionado su firma. ¿Desea continuar de todos modos?')) {
                        return;
                    }
                }
                
                // Si todo está correcto, mostrar confirmación
                const apoderadoNombre = document.getElementById('nombresApoderado').value + ' ' + document.getElementById('apellidosApoderado').value;
                const postulanteNombre = document.getElementById('nombresPostulante').value + ' ' + document.getElementById('apellidosPostulante').value;
                
                if (confirm(`¿Confirma que desea enviar la declaración jurada a nombre de ${apoderadoNombre} como apoderado de ${postulanteNombre}?`)) {
                    alert('Declaración jurada enviada correctamente. Se ha registrado su solicitud.');
                    // En un caso real, aquí enviarías los datos al servidor
                    // form.submit();
                }
            });
            
            // Copiar DNI del apoderado a verificación si están vacíos
            const dniApoderadoInput = document.getElementById('dniApoderado');
            const dniFirmaInput = document.getElementById('dniFirma');
            
            dniApoderadoInput.addEventListener('blur', function() {
                if (!dniFirmaInput.value && dniApoderadoInput.value) {
                    dniFirmaInput.value = dniApoderadoInput.value;
                }
            });
            
            // Validar DNI en tiempo real
            function validarDNI(input) {
                input.value = input.value.replace(/\D/g, '');
                if (input.value.length > 8) {
                    input.value = input.value.substring(0, 8);
                }
            }
            
            dniApoderadoInput.addEventListener('input', function() {
                validarDNI(this);
            });
            
            document.getElementById('dniPostulante').addEventListener('input', function() {
                validarDNI(this);
            });
            
            dniFirmaInput.addEventListener('input', function() {
                validarDNI(this);
            });
        });
    </script>
</body>
</html>