<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaración Jurada - IESTP María Rosario Araoz Pinto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="CSS/DeclaJurada.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-file-signature"></i> Declaración Jurada de Documentos</h1>
            <p class="subtitle">IESTP María Rosario Araoz Pinto</p>
            <p>Complete los siguientes formularios con la información requerida</p>
        </header>

        <div class="tab-container">
            <div class="tab active" data-tab="declaracion1">Declaración General</div>
            <div class="tab" data-tab="declaracion2">Postulante Menor de Edad</div>
        </div>

        <div class="forms-container">
            <!-- Declaración General (basada en la primera imagen) -->
            <div id="declaracion1" class="tab-content active form-section">
                <h2>DECLARACIÓN JURADA DE DOCUMENTOS</h2>
                
                <div class="form-group">
                    <label class="required">Determinar adiósicas y retrampes</label>
                    <input type="text" class="form-control" id="adiosticas" placeholder="Ingrese información">
                </div>
                
                <div class="form-group">
                    <label>Análisis de suplente</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="analisis1">
                        <label for="analisis1">Análisis de suplente 1</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="analisis2">
                        <label for="analisis2">Análisis de suplente 2</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Nota de gobierno</label>
                    <textarea class="form-control" rows="3" id="notaGobierno" placeholder="Ingrese nota de gobierno"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Semestre</label>
                    <select class="form-control" id="semestre">
                        <option value="">Seleccione semestre</option>
                        <option value="1">Semestre 1</option>
                        <option value="2">Semestre 2</option>
                        <option value="3">Semestre 3</option>
                        <option value="4">Semestre 4</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Primeros en el producto</label>
                    <input type="text" class="form-control" id="primerosProducto" placeholder="Ingrese información">
                </div>
                
                <div class="form-group">
                    <label>Estructura</label>
                    <textarea class="form-control" rows="3" id="estructura" placeholder="Describa la estructura"></textarea>
                </div>
                
                <div class="signature-section">
                    <h3><i class="fas fa-signature"></i> Firma Virtual</h3>
                    <p>Dibuje su firma en el recuadro inferior:</p>
                    <div class="signature-container">
                        <canvas id="signatureCanvas1" class="signature-canvas"></canvas>
                    </div>
                    <div class="signature-actions">
                        <button class="btn btn-outline" id="clearSignature1">
                            <i class="fas fa-eraser"></i> Limpiar Firma
                        </button>
                        <button class="btn btn-secondary" id="saveSignature1">
                            <i class="fas fa-save"></i> Guardar Firma
                        </button>
                    </div>
                </div>
                
                <div class="fingerprint-section">
                    <h3><i class="fas fa-fingerprint"></i> Huella Digital</h3>
                    <p>Suba o capture la huella digital:</p>
                    <div class="fingerprint-container">
                        <div class="fingerprint-placeholder">
                            <i class="fas fa-fingerprint"></i>
                            <p>Huella digital no cargada</p>
                        </div>
                        <img id="fingerprintPreview1" class="fingerprint-preview" alt="Vista previa de huella">
                    </div>
                    <div class="signature-actions">
                        <button class="btn btn-outline" id="uploadFingerprint1">
                            <i class="fas fa-upload"></i> Subir Huella
                        </button>
                        <button class="btn btn-outline" id="clearFingerprint1">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </div>
                    <input type="file" id="fingerprintInput1" accept="image/*" style="display: none;">
                </div>
                
                <div class="legal-text">
                    <p><strong>Nota:</strong> Antes de ser del Código Penal: Este es un procedimiento administrativo, hace este último documento en relación técnica e circunstancia que le consiguiere poder solicitarlo, permitiendo de veredades establecidas en lo que esté requerido con una práctica de licencia en menos de uno de mayo de cuatro años.</p>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-pdf" id="generatePdf1">
                        <i class="fas fa-file-pdf"></i> Generar y Descargar PDF
                    </button>
                </div>
            </div>

            <!-- Declaración para Postulante Menor de Edad (basada en la segunda imagen) -->
            <div id="declaracion2" class="tab-content form-section">
                <h2>DECLARACIÓN JURADA DE DOCUMENTOS</h2>
                <p class="subtitle">(POSTULANTE MENOR DE EDAD)</p>
                
                <div class="declaration-text">
                    <p>Autorizo al IESTP María Rosario Araoz Pinto la verificación de la presente DECLARACIÓN JURADA, asumiendo la responsabilidad civil y/o penal de comprobarse la falsedad de la información registrada al momento de mi inscripción. De faltar a la verdad en esta declaración me sujeto a los alcances de lo establecido en el artículo 411° del Código Penal y acepto la anulación del examen de admisión del IESTP María Rosario Araoz Pinto, sin lugar a reclamo.</p>
                </div>
                
                <div class="form-group">
                    <label class="required">Apellidos y Nombres del apoderado</label>
                    <input type="text" class="form-control" id="apoderadoNombre" value="JOSE FERNADO GUERRERO SANCHEZ" placeholder="Ingrese nombre completo">
                </div>
                
                <div class="form-group">
                    <label class="required">D.N.I. o Carné de Extranjería del apoderado</label>
                    <input type="text" class="form-control" id="apoderadoDNI" value="41475286" placeholder="Ingrese número de documento">
                </div>
                
                <div class="form-group">
                    <label class="required">Domicilio del apoderado</label>
                    <input type="text" class="form-control" id="apoderadoDomicilio" value="PASAJE CAPIUDE 112, CARMEN DE LA LEGUA- REYNOSO" placeholder="Ingrese domicilio">
                </div>
                
                <div class="form-group">
                    <label class="required">Nombre y apellidos del postulante menor de edad</label>
                    <input type="text" class="form-control" id="postulanteNombre" value="JOSE FERNADO GUERRERO URDANETA" placeholder="Ingrese nombre completo">
                </div>
                
                <div class="form-group">
                    <label class="required">D.N.I. del postulante</label>
                    <input type="text" class="form-control" id="postulanteDNI" value="90963100" placeholder="Ingrese número de documento">
                </div>
                
                <div class="form-group">
                    <label class="required">Institución Educativa donde culminó secundaria</label>
                    <input type="text" class="form-control" id="institucionEducativa" value="JE Raúl Porras Barrenechea" placeholder="Ingrese nombre de la institución">
                </div>
                
                <div class="form-group">
                    <label>Declaro bajo juramento que:</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion1" checked>
                        <label for="declaracion1">Mis datos personales y los de mi hijo(a) son los mismos que figuran en los documentos de identidad.</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion2" checked>
                        <label for="declaracion2">Los documentos proporcionados virtualmente son fidedignos a los originales.</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="declaracion3" checked>
                        <label for="declaracion3">Mi hijo(a) ha culminado satisfactoriamente sus estudios de nivel secundaria.</label>
                    </div>
                </div>
                
                <div class="signature-section">
                    <h3><i class="fas fa-signature"></i> Firma del Apoderado</h3>
                    <p>Dibuje la firma del apoderado en el recuadro inferior:</p>
                    <div class="signature-container">
                        <canvas id="signatureCanvas2" class="signature-canvas"></canvas>
                    </div>
                    <div class="signature-actions">
                        <button class="btn btn-outline" id="clearSignature2">
                            <i class="fas fa-eraser"></i> Limpiar Firma
                        </button>
                        <button class="btn btn-secondary" id="saveSignature2">
                            <i class="fas fa-save"></i> Guardar Firma
                        </button>
                    </div>
                </div>
                
                <div class="fingerprint-section">
                    <h3><i class="fas fa-fingerprint"></i> Huella Digital del Apoderado</h3>
                    <p>Suba o capture la huella digital (índice derecho):</p>
                    <div class="fingerprint-container">
                        <div class="fingerprint-placeholder">
                            <i class="fas fa-fingerprint"></i>
                            <p>Huella digital no cargada</p>
                        </div>
                        <img id="fingerprintPreview2" class="fingerprint-preview" alt="Vista previa de huella">
                    </div>
                    <div class="signature-actions">
                        <button class="btn btn-outline" id="uploadFingerprint2">
                            <i class="fas fa-upload"></i> Subir Huella
                        </button>
                        <button class="btn btn-outline" id="clearFingerprint2">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </div>
                    <input type="file" id="fingerprintInput2" accept="image/*" style="display: none;">
                </div>
                
                <div class="legal-text">
                    <p><strong>Artículo 411°:</strong> El que, en un procedimiento administrativo, hace una falsa declaración en relación a hechos o circunstancias que le corresponde probar, violando la presunción de veracidad establecida por ley, será reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro años.</p>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-pdf" id="generatePdf2">
                        <i class="fas fa-file-pdf"></i> Generar y Descargar PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Progress indicator -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-content">
                <div class="spinner"></div>
                <h3>Generando PDF...</h3>
                <p>Por favor espere mientras se procesa su documento.</p>
            </div>
        </div>
        
        <!-- PDF Preview Modal -->
        <div class="pdf-preview" id="pdfPreview">
            <div class="pdf-preview-content">
                <button class="close-preview" id="closePreview">&times;</button>
                <h3>Vista previa del PDF</h3>
                <div id="pdfContent"></div>
            </div>
        </div>
        
        <div class="footer">
            <p><i class="fas fa-info-circle"></i> IESTP María Rosario Araoz Pinto - Todos los derechos reservados © 2024</p>
            <p>Este formulario cumple con la Ley N.° 30512 de Institutos y Escuelas de Educación Superior</p>
        </div>
    </div>

    <script>
        // Variables globales para las firmas
        let canvas1, canvas2, ctx1, ctx2;
        let drawing1 = false, drawing2 = false;
        let savedSignature1 = false, savedSignature2 = false;
        let fingerprint1Base64 = null, fingerprint2Base64 = null;
        let signature1Base64 = null, signature2Base64 = null;

        // Inicializar cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar pestañas
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Remover clase active de todas las pestañas
                    tabs.forEach(t => t.classList.remove('active'));
                    // Agregar clase active a la pestaña clickeada
                    tab.classList.add('active');
                    
                    // Ocultar todos los contenidos
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Mostrar el contenido correspondiente
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Inicializar canvas para firma 1
            canvas1 = document.getElementById('signatureCanvas1');
            ctx1 = canvas1.getContext('2d');
            resizeCanvas(canvas1, ctx1);
            
            // Inicializar canvas para firma 2
            canvas2 = document.getElementById('signatureCanvas2');
            ctx2 = canvas2.getContext('2d');
            resizeCanvas(canvas2, ctx2);
            
            // Configurar eventos para firma 1
            setupCanvasEvents(canvas1, ctx1, 1);
            
            // Configurar eventos para firma 2
            setupCanvasEvents(canvas2, ctx2, 2);
            
            // Configurar botones para firma 1
            document.getElementById('clearSignature1').addEventListener('click', () => clearSignature(1));
            document.getElementById('saveSignature1').addEventListener('click', () => saveSignature(1));
            
            // Configurar botones para firma 2
            document.getElementById('clearSignature2').addEventListener('click', () => clearSignature(2));
            document.getElementById('saveSignature2').addEventListener('click', () => saveSignature(2));
            
            // Configurar eventos para huella digital 1
            document.getElementById('uploadFingerprint1').addEventListener('click', () => document.getElementById('fingerprintInput1').click());
            document.getElementById('clearFingerprint1').addEventListener('click', () => clearFingerprint(1));
            document.getElementById('fingerprintInput1').addEventListener('change', (e) => handleFingerprintUpload(e, 1));
            
            // Configurar eventos para huella digital 2
            document.getElementById('uploadFingerprint2').addEventListener('click', () => document.getElementById('fingerprintInput2').click());
            document.getElementById('clearFingerprint2').addEventListener('click', () => clearFingerprint(2));
            document.getElementById('fingerprintInput2').addEventListener('change', (e) => handleFingerprintUpload(e, 2));
            
            // Configurar botones de generación de PDF
            document.getElementById('generatePdf1').addEventListener('click', () => generatePDF(1));
            document.getElementById('generatePdf2').addEventListener('click', () => generatePDF(2));
            
            // Configurar botón para cerrar vista previa
            document.getElementById('closePreview').addEventListener('click', () => {
                document.getElementById('pdfPreview').style.display = 'none';
            });
            
            // Redimensionar canvas cuando cambie el tamaño de la ventana
            window.addEventListener('resize', () => {
                resizeCanvas(canvas1, ctx1);
                resizeCanvas(canvas2, ctx2);
            });
        });
        
        function resizeCanvas(canvas, ctx) {
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;
            
            // Configurar estilo del contexto
            ctx.strokeStyle = '#2e8b57';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }
        
        function setupCanvasEvents(canvas, ctx, canvasNumber) {
            // Iniciar dibujo
            canvas.addEventListener('mousedown', (e) => startDrawing(e, canvasNumber));
            canvas.addEventListener('touchstart', (e) => startDrawing(e, canvasNumber));
            
            // Dibujar
            canvas.addEventListener('mousemove', (e) => draw(e, canvasNumber));
            canvas.addEventListener('touchmove', (e) => draw(e, canvasNumber));
            
            // Detener dibujo
            canvas.addEventListener('mouseup', () => stopDrawing(canvasNumber));
            canvas.addEventListener('mouseout', () => stopDrawing(canvasNumber));
            canvas.addEventListener('touchend', () => stopDrawing(canvasNumber));
        }
        
        function startDrawing(e, canvasNumber) {
            if (canvasNumber === 1) drawing1 = true;
            else drawing2 = true;
            
            draw(e, canvasNumber);
        }
        
        function draw(e, canvasNumber) {
            e.preventDefault();
            
            if ((canvasNumber === 1 && !drawing1) || (canvasNumber === 2 && !drawing2)) return;
            
            const canvas = canvasNumber === 1 ? canvas1 : canvas2;
            const ctx = canvasNumber === 1 ? ctx1 : ctx2;
            
            // Obtener coordenadas
            let clientX, clientY;
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            
            // Dibujar
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }
        
        function stopDrawing(canvasNumber) {
            if (canvasNumber === 1) {
                drawing1 = false;
                ctx1.beginPath();
            } else {
                drawing2 = false;
                ctx2.beginPath();
            }
        }
        
        function clearSignature(canvasNumber) {
            const canvas = canvasNumber === 1 ? canvas1 : canvas2;
            const ctx = canvasNumber === 1 ? ctx1 : ctx2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (canvasNumber === 1) {
                savedSignature1 = false;
                signature1Base64 = null;
            } else {
                savedSignature2 = false;
                signature2Base64 = null;
            }
            
            alert(`Firma ${canvasNumber} ha sido limpiada`);
        }
        
        function saveSignature(canvasNumber) {
            const canvas = canvasNumber === 1 ? canvas1 : canvas2;
            
            // Verificar si hay algo dibujado
            const blank = document.createElement('canvas');
            blank.width = canvas.width;
            blank.height = canvas.height;
            
            if (canvas.toDataURL() === blank.toDataURL()) {
                alert(`Por favor, dibuje su firma primero antes de guardar`);
                return;
            }
            
            // Guardar la firma como base64
            if (canvasNumber === 1) {
                savedSignature1 = true;
                signature1Base64 = canvas.toDataURL('image/png');
            } else {
                savedSignature2 = true;
                signature2Base64 = canvas.toDataURL('image/png');
            }
            
            alert(`Firma ${canvasNumber} guardada correctamente`);
        }
        
        function handleFingerprintUpload(e, fingerprintNumber) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const previewId = `fingerprintPreview${fingerprintNumber}`;
                    const preview = document.getElementById(previewId);
                    const placeholder = preview.parentElement.querySelector('.fingerprint-placeholder');
                    
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    
                    // Guardar la huella como base64
                    if (fingerprintNumber === 1) {
                        fingerprint1Base64 = event.target.result;
                    } else {
                        fingerprint2Base64 = event.target.result;
                    }
                    
                    alert(`Huella digital ${fingerprintNumber} cargada correctamente`);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function clearFingerprint(fingerprintNumber) {
            const previewId = `fingerprintPreview${fingerprintNumber}`;
            const inputId = `fingerprintInput${fingerprintNumber}`;
            
            const preview = document.getElementById(previewId);
            const placeholder = preview.parentElement.querySelector('.fingerprint-placeholder');
            const input = document.getElementById(inputId);
            
            preview.src = '';
            preview.style.display = 'none';
            placeholder.style.display = 'block';
            input.value = '';
            
            // Limpiar base64
            if (fingerprintNumber === 1) {
                fingerprint1Base64 = null;
            } else {
                fingerprint2Base64 = null;
            }
            
            alert(`Huella digital ${fingerprintNumber} eliminada`);
        }
        
        function showProgress(show) {
            const progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = show ? 'flex' : 'none';
        }
        
        function generatePDF(formNumber) {
            // Validar campos requeridos
            const requiredFields = document.querySelectorAll(`#declaracion${formNumber} .required`);
            let allValid = true;
            
            requiredFields.forEach(field => {
                const input = field.closest('.form-group').querySelector('input, textarea, select');
                if (input && !input.value.trim()) {
                    allValid = false;
                    input.style.borderColor = '#d9534f';
                } else if (input) {
                    input.style.borderColor = '#c1e1d2';
                }
            });
            
            if (!allValid) {
                alert('Por favor, complete todos los campos requeridos marcados con *');
                return;
            }
            
            // Verificar si la firma está guardada
            if (formNumber === 1 && !savedSignature1) {
                alert('Por favor, guarde su firma antes de generar el PDF');
                return;
            }
            
            if (formNumber === 2 && !savedSignature2) {
                alert('Por favor, guarde la firma del apoderado antes de generar el PDF');
                return;
            }
            
            // Mostrar indicador de progreso
            showProgress(true);
            
            // Esperar un momento para que se muestre el indicador
            setTimeout(() => {
                try {
                    // Usar jsPDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'a4');
                    
                    // Configuración inicial
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const margin = 20;
                    let yPosition = margin;
                    
                    // Título principal
                    doc.setFontSize(18);
                    doc.setTextColor(46, 139, 87); // Verde
                    doc.text('DECLARACIÓN JURADA DE DOCUMENTOS', pageWidth / 2, yPosition, { align: 'center' });
                    
                    yPosition += 10;
                    
                    // Subtítulo según el formulario
                    doc.setFontSize(14);
                    if (formNumber === 2) {
                        doc.text('(POSTULANTE MENOR DE EDAD)', pageWidth / 2, yPosition, { align: 'center' });
                        yPosition += 10;
                    }
                    
                    doc.setTextColor(0, 0, 0); // Negro
                    doc.setFontSize(10);
                    
                    // Datos específicos según el formulario
                    if (formNumber === 1) {
                        // Formulario 1: Declaración General
                        yPosition = addForm1Data(doc, yPosition, pageWidth, margin);
                    } else {
                        // Formulario 2: Postulante Menor de Edad
                        yPosition = addForm2Data(doc, yPosition, pageWidth, margin);
                    }
                    
                    // Agregar firma al PDF
                    yPosition += 10;
                    doc.setFontSize(12);
                    doc.setTextColor(46, 139, 87);
                    doc.text('FIRMA:', margin, yPosition);
                    
                    yPosition += 5;
                    
                    // Insertar imagen de la firma
                    const signatureBase64 = formNumber === 1 ? signature1Base64 : signature2Base64;
                    if (signatureBase64) {
                        try {
                            doc.addImage(signatureBase64, 'PNG', margin, yPosition, 60, 30);
                            yPosition += 35;
                        } catch (error) {
                            console.error('Error al agregar firma:', error);
                            doc.text('Firma no disponible', margin, yPosition);
                            yPosition += 10;
                        }
                    }
                    
                    // Agregar huella digital al PDF
                    doc.text('HUELLA DIGITAL:', margin, yPosition);
                    yPosition += 5;
                    
                    // Insertar imagen de la huella digital
                    const fingerprintBase64 = formNumber === 1 ? fingerprint1Base64 : fingerprint2Base64;
                    if (fingerprintBase64) {
                        try {
                            doc.addImage(fingerprintBase64, 'JPEG', margin, yPosition, 40, 40);
                            yPosition += 45;
                        } catch (error) {
                            console.error('Error al agregar huella:', error);
                            doc.text('Huella digital no disponible', margin, yPosition);
                            yPosition += 10;
                        }
                    }
                    
                    // Agregar texto legal
                    yPosition += 10;
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    
                    if (formNumber === 1) {
                        doc.text('Nota: Antes de ser del Código Penal: Este es un procedimiento administrativo, hace este último documento en relación técnica e circunstancia que le consiguiere poder solicitarlo, permitiendo de veredades establecidas en lo que esté requerido con una práctica de licencia en menos de uno de mayo de cuatro años.', 
                                margin, yPosition, { maxWidth: pageWidth - 2 * margin });
                    } else {
                        doc.text('Artículo 411°: El que, en un procedimiento administrativo, hace una falsa declaración en relación a hechos o circunstancias que le corresponde probar, violando la presunción de veracidad establecida por ley, será reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro años.', 
                                margin, yPosition, { maxWidth: pageWidth - 2 * margin });
                    }
                    
                    // Pie de página
                    doc.setFontSize(8);
                    doc.setTextColor(100, 100, 100);
                    const fecha = new Date().toLocaleDateString('es-PE', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric'
                    });
                    doc.text(`Generado el: ${fecha}`, margin, doc.internal.pageSize.getHeight() - 10);
                    doc.text('IESTP María Rosario Araoz Pinto', pageWidth / 2, doc.internal.pageSize.getHeight() - 10, { align: 'center' });
                    
                    // Guardar el PDF
                    const fileName = formNumber === 1 ? 'declaracion_jurada_general.pdf' : 'declaracion_jurada_menor_edad.pdf';
                    doc.save(fileName);
                    
                    // Ocultar indicador de progreso
                    showProgress(false);
                    
                    alert('PDF generado y descargado correctamente');
                    
                } catch (error) {
                    console.error('Error al generar PDF:', error);
                    showProgress(false);
                    alert('Error al generar el PDF. Por favor, intente nuevamente.');
                }
            }, 500);
        }
        
        function addForm1Data(doc, yPosition, pageWidth, margin) {
            // Recopilar datos del formulario 1
            const adiosticas = document.getElementById('adiosticas').value;
            const notaGobierno = document.getElementById('notaGobierno').value;
            const semestre = document.getElementById('semestre').value;
            const primerosProducto = document.getElementById('primerosProducto').value;
            const estructura = document.getElementById('estructura').value;
            const analisis1 = document.getElementById('analisis1').checked;
            const analisis2 = document.getElementById('analisis2').checked;
            
            // Agregar datos al PDF
            doc.setFontSize(11);
            
            // Determinar adiósicas y retrampes
            doc.text(`Determinar adiósicas y retrampes: ${adiosticas || 'No especificado'}`, margin, yPosition);
            yPosition += 8;
            
            // Análisis de suplente
            let analisisText = 'Análisis de suplente: ';
            if (analisis1) analisisText += 'Análisis 1 ';
            if (analisis2) analisisText += 'Análisis 2 ';
            if (!analisis1 && !analisis2) analisisText += 'No seleccionado';
            
            doc.text(analisisText, margin, yPosition);
            yPosition += 8;
            
            // Nota de gobierno
            if (notaGobierno) {
                doc.text('Nota de gobierno:', margin, yPosition);
                yPosition += 5;
                const splitNota = doc.splitTextToSize(notaGobierno, pageWidth - 2 * margin);
                doc.text(splitNota, margin, yPosition);
                yPosition += splitNota.length * 5;
            }
            
            // Semestre
            if (semestre) {
                doc.text(`Semestre: ${semestre}`, margin, yPosition);
                yPosition += 8;
            }
            
            // Primeros en el producto
            if (primerosProducto) {
                doc.text(`Primeros en el producto: ${primerosProducto}`, margin, yPosition);
                yPosition += 8;
            }
            
            // Estructura
            if (estructura) {
                doc.text('Estructura:', margin, yPosition);
                yPosition += 5;
                const splitEstructura = doc.splitTextToSize(estructura, pageWidth - 2 * margin);
                doc.text(splitEstructura, margin, yPosition);
                yPosition += splitEstructura.length * 5;
            }
            
            return yPosition;
        }
        
        function addForm2Data(doc, yPosition, pageWidth, margin) {
            // Recopilar datos del formulario 2
            const apoderadoNombre = document.getElementById('apoderadoNombre').value;
            const apoderadoDNI = document.getElementById('apoderadoDNI').value;
            const apoderadoDomicilio = document.getElementById('apoderadoDomicilio').value;
            const postulanteNombre = document.getElementById('postulanteNombre').value;
            const postulanteDNI = document.getElementById('postulanteDNI').value;
            const institucionEducativa = document.getElementById('institucionEducativa').value;
            const declaracion1 = document.getElementById('declaracion1').checked;
            const declaracion2 = document.getElementById('declaracion2').checked;
            const declaracion3 = document.getElementById('declaracion3').checked;
            
            // Agregar datos al PDF
            doc.setFontSize(11);
            
            // Texto de declaración
            const declaracionText = 'Autorizo al IESTP María Rosario Araoz Pinto la verificación de la presente DECLARACIÓN JURADA, asumiendo la responsabilidad civil y/o penal de comprobarse la falsedad de la información registrada al momento de mi inscripción. De faltar a la verdad en esta declaración me sujeto a los alcances de lo establecido en el artículo 411° del Código Penal y acepto la anulación del examen de admisión del IESTP María Rosario Araoz Pinto, sin lugar a reclamo.';
            
            const splitDeclaracion = doc.splitTextToSize(declaracionText, pageWidth - 2 * margin);
            doc.text(splitDeclaracion, margin, yPosition);
            yPosition += splitDeclaracion.length * 5 + 5;
            
            // Datos del apoderado
            doc.setFontSize(12);
            doc.setTextColor(46, 139, 87);
            doc.text('DATOS DEL APODERADO:', margin, yPosition);
            yPosition += 8;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(`Apellidos y Nombres: ${apoderadoNombre}`, margin, yPosition);
            yPosition += 7;
            doc.text(`DNI: ${apoderadoDNI}`, margin, yPosition);
            yPosition += 7;
            doc.text(`Domicilio: ${apoderadoDomicilio}`, margin, yPosition);
            yPosition += 10;
            
            // Datos del postulante
            doc.setFontSize(12);
            doc.setTextColor(46, 139, 87);
            doc.text('DATOS DEL POSTULANTE:', margin, yPosition);
            yPosition += 8;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(`Nombre y apellidos: ${postulanteNombre}`, margin, yPosition);
            yPosition += 7;
            doc.text(`DNI: ${postulanteDNI}`, margin, yPosition);
            yPosition += 7;
            doc.text(`Institución Educativa: ${institucionEducativa}`, margin, yPosition);
            yPosition += 10;
            
            // Declaraciones
            doc.setFontSize(12);
            doc.setTextColor(46, 139, 87);
            doc.text('DECLARO BAJO JURAMENTO QUE:', margin, yPosition);
            yPosition += 8;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const check = '✓';
            const uncheck = '□';
            
            doc.text(`${declaracion1 ? check : uncheck} Mis datos personales y los de mi hijo(a) son los mismos que figuran en los documentos de identidad.`, margin, yPosition);
            yPosition += 7;
            
            doc.text(`${declaracion2 ? check : uncheck} Los documentos proporcionados virtualmente son fidedignos a los originales.`, margin, yPosition);
            yPosition += 7;
            
            doc.text(`${declaracion3 ? check : uncheck} Mi hijo(a) ha culminado satisfactoriamente sus estudios de nivel secundaria.`, margin, yPosition);
            yPosition += 10;
            
            return yPosition;
        }
    </script>
</body>
</html>