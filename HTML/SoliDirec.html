<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solicitud de Inscripción y Acta de Compromiso</title>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="CSS/Solidirect.css">

</head>

<body>
    <div class="container">

        <section class="document-container">
            <header class="header">
                <div class="header-line">
                    <span>IESTP María Rosario Araoz Pinto</span>
                    <span>Ministerio de Educación</span>
                </div>
                <h1>SOLICITUD DE INSCRIPCIÓN</h1>
                <h2>Y ACTA DE COMPROMISO</h2>
            </header>

            <div class="carta-content">
                <div class="document-title">
                    <strong>Instituto de Educación Superior Tecnológico Público<br>
                        María Rosario Araoz Pinto</strong>
                </div>

                <div class="destinatario">
                    <strong>SR. DIRECTOR DEL IESTP. "MARIA ROSARIO ARAOZ PINTO"</strong>
                </div>

                <form id="solicitudForm">
                    <div class="field-row">
                        <label>APELLIDO PATERNO</label>
                        <input type="text" id="apellidoPaterno" required class="inline-field">
                        <label>APELLIDO MATERNO</label>
                        <input type="text" id="apellidoMaterno" class="inline-field">
                    </div>

                    <div class="field-row">
                        <label>NOMBRES</label>
                        <input type="text" id="nombresSolicitud" required>
                    </div>

                    <div class="field-row">
                        <label>DOCUMENTO DE IDENTIDAD</label>
                        <input type="text" id="dniSolicitud" maxlength="8" required pattern="[0-9]{8}"
                            class="inline-field">
                        <label>DOMICILIO ACTUAL</label>
                        <input type="text" id="domicilioSolicitud" required>
                    </div>

                    <div class="text-block">
                        <strong>ANTE UD., ME PRESENTO Y EXPONGO:</strong>
                    </div>

                    <div class="text-block">
                        Declaro cumplir con los requisitos establecidos en el Reglamento de
                        Admisión, para mi postulación.<br>
                        Que acato en todos sus términos el Reglamento de Admisión.
                    </div>

                    <div class="text-block">
                        Por tanto solicito a Ud., señor Director, se sirva disponer mi inscripción como
                        postulante a la Especialidad de:
                    </div>

                    <div class="field-row">
                        <label>Especialidad</label>
                        <input type="text" id="especialidad" required>
                    </div>

                    <div class="field-row">
                        <label>Turno</label>
                        <input type="text" id="turno" placeholder="......" required style="width: 150px;">
                        <label style="min-width: 120px;">Modalidad</label>
                        <input type="text" id="modalidad" placeholder="......" required style="width: 150px;">
                    </div>

                    <div class="text-block">
                        Adjunto a la presente los documentos solicitados por el Reglamento de ADMISIÓN
                        <input type="text" id="anioReglamento" placeholder="20......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                    </div>

                    <div class="fecha-lugar">
                        San Miguel,
                        <input type="text" id="dia" placeholder="......"
                            style="width: 50px; display: inline-block; margin: 0 5px;">
                        de
                        <input type="text" id="mes" placeholder="......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                        del
                        <input type="text" id="anio" placeholder="20......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                    </div>

                    <div class="signature-section">
                        <p class="firma-label">FIRMA DEL POSTULANTE</p>
                        <div class="signature-box" id="signatureBox1">
                            <canvas id="signatureCanvas1"></canvas>
                            <span class="signature-placeholder" id="ph1">Firme aquí con el mouse o touch</span>
                        </div>
                        <small style="color: #64748b; display: block; margin-top: 5px;">
                            Haga clic y arrastre para firmar
                        </small>
                    </div>
                </form>
            </div>
        </section>

        <!-- ACTA DE COMPROMISO -->
        <section class="document-container">
            <header class="header">
                <h1>ACTA DE COMPROMISO</h1>
            </header>

            <div class="carta-content">
                <div class="document-title">
                    <strong>Instituto de Educación Superior Tecnológico Público<br>
                        María Rosario Araoz Pinto</strong>
                </div>

                <form id="actaForm">
                    <div class="formatted-text">
                        Yo, <input type="text" id="nombreActa" required
                            style="width: 300px; display: inline-block; margin: 0 5px;">
                        identificado con D.N.I. N°
                        <input type="text" id="dniActa" maxlength="8" required pattern="[0-9]{8}"
                            style="width: 120px; display: inline-block; margin: 0 5px;">
                        domiciliado en la Av., Jr., Calle N°
                        <input type="text" id="calleActa" required
                            style="width: 200px; display: inline-block; margin: 0 5px;">
                        <input type="text" id="distritoActa" placeholder="Distrito......" required
                            style="width: 150px; display: inline-block; margin: 0 5px;">
                    </div>

                    <div class="text-block">
                        mediante la presente Acta me comprometo completar mi CARPETA DE POSTULANTE de acuerdo a los
                        requisitos solicitados por el REGLAMENTO DE ADMISIÓN
                        <input type="text" id="anioReglamentoActa" placeholder="20......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                        del IESTP "MARIA ROSARIO ARAOZ PINTO", dentro de 72 horas, después de haber sido publicado el
                        cuadro de méritos correspondientes. De no cumplir con este requisito perderé la vacante obtenida
                        en el concurso de admisión sin lugar a reclamos. Para dar fe a dicho compromiso, suscribo la
                        presente Acta.
                    </div>

                    <div class="fecha-lugar">
                        San Miguel,
                        <input type="text" id="diaActa" placeholder="......"
                            style="width: 50px; display: inline-block; margin: 0 5px;">
                        de
                        <input type="text" id="mesActa" placeholder="......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                        del
                        <input type="text" id="anioActa" placeholder="20......"
                            style="width: 80px; display: inline-block; margin: 0 5px;">
                    </div>

                    <div
                        style="margin-top: 40px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <p style="font-weight: bold; margin-bottom: 10px;">Huella Digital</p>
                            <p style="margin-top: 60px;">Índice derecho</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-weight: bold; margin-bottom: 10px;">Firma</p>
                            <div class="signature-box" id="signatureBox2" style="width: 250px; height: 100px;">
                                <canvas id="signatureCanvas2"></canvas>
                                <span class="signature-placeholder" id="ph2">Firme aquí</span>
                            </div>
                            <p style="margin-top: 10px;">DNI. N°
                                <input type="text" id="dniFirma" placeholder="......"
                                    style="width: 120px; display: inline-block; margin-left: 5px;">
                            </p>
                        </div>
                    </div>
                </form>
            </div>
        </section>

        <!-- BOTONES -->
        <div class="button-group">
            <button id="limpiarBtn">Limpiar firmas</button>
            <button id="generarPdfBtn">Descargar PDF</button>
        </div>
    </div>

    <script>
        // Acceso a jsPDF
        const { jsPDF } = window.jspdf;

        // Variables globales
        let isDrawing1 = false;
        let isDrawing2 = false;
        let ctx1, ctx2;

        // Inicializar canvas
        function initCanvas() {
            const canvas1 = document.getElementById('signatureCanvas1');
            const canvas2 = document.getElementById('signatureCanvas2');

            // Ajustar tamaño del canvas
            canvas1.width = canvas1.parentElement.clientWidth;
            canvas1.height = canvas1.parentElement.clientHeight;

            canvas2.width = canvas2.parentElement.clientWidth;
            canvas2.height = canvas2.parentElement.clientHeight;

            // Obtener contextos
            ctx1 = canvas1.getContext('2d');
            ctx2 = canvas2.getContext('2d');

            // Configurar estilo de dibujo
            ctx1.strokeStyle = '#0f766e';
            ctx1.lineWidth = 2;
            ctx1.lineCap = 'round';
            ctx1.lineJoin = 'round';

            ctx2.strokeStyle = '#0f766e';
            ctx2.lineWidth = 2;
            ctx2.lineCap = 'round';
            ctx2.lineJoin = 'round';

            // Configurar eventos para el primer canvas
            canvas1.addEventListener('mousedown', startDrawing1);
            canvas1.addEventListener('mousemove', draw1);
            canvas1.addEventListener('mouseup', stopDrawing1);
            canvas1.addEventListener('mouseout', stopDrawing1);

            // Eventos táctiles para móviles
            canvas1.addEventListener('touchstart', handleTouchStart1);
            canvas1.addEventListener('touchmove', handleTouchMove1);
            canvas1.addEventListener('touchend', stopDrawing1);

            // Configurar eventos para el segundo canvas
            canvas2.addEventListener('mousedown', startDrawing2);
            canvas2.addEventListener('mousemove', draw2);
            canvas2.addEventListener('mouseup', stopDrawing2);
            canvas2.addEventListener('mouseout', stopDrawing2);

            // Eventos táctiles para móviles
            canvas2.addEventListener('touchstart', handleTouchStart2);
            canvas2.addEventListener('touchmove', handleTouchMove2);
            canvas2.addEventListener('touchend', stopDrawing2);
        }

        // Funciones para el primer canvas
        function startDrawing1(e) {
            isDrawing1 = true;
            document.getElementById('ph1').classList.add('hidden');
            draw1(e);
        }

        function draw1(e) {
            if (!isDrawing1) return;

            e.preventDefault();
            const canvas = document.getElementById('signatureCanvas1');
            const rect = canvas.getBoundingClientRect();

            let x, y;
            if (e.type.includes('touch')) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }

            ctx1.lineTo(x, y);
            ctx1.stroke();
            ctx1.beginPath();
            ctx1.moveTo(x, y);
        }

        function stopDrawing1() {
            isDrawing1 = false;
            ctx1.beginPath();
        }

        // Funciones táctiles para primer canvas
        function handleTouchStart1(e) {
            if (e.cancelable) e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousedown", {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            startDrawing1(mouseEvent);
        }

        function handleTouchMove1(e) {
            if (e.cancelable) e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousemove", {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            draw1(mouseEvent);
        }

        // Funciones para el segundo canvas
        function startDrawing2(e) {
            isDrawing2 = true;
            document.getElementById('ph2').classList.add('hidden');
            draw2(e);
        }

        function draw2(e) {
            if (!isDrawing2) return;

            e.preventDefault();
            const canvas = document.getElementById('signatureCanvas2');
            const rect = canvas.getBoundingClientRect();

            let x, y;
            if (e.type.includes('touch')) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }

            ctx2.lineTo(x, y);
            ctx2.stroke();
            ctx2.beginPath();
            ctx2.moveTo(x, y);
        }

        function stopDrawing2() {
            isDrawing2 = false;
            ctx2.beginPath();
        }

        // Funciones táctiles para segundo canvas
        function handleTouchStart2(e) {
            if (e.cancelable) e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousedown", {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            startDrawing2(mouseEvent);
        }

        function handleTouchMove2(e) {
            if (e.cancelable) e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousemove", {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            draw2(mouseEvent);
        }

        // Limpiar firmas
        function limpiarFirmas() {
            const canvas1 = document.getElementById('signatureCanvas1');
            const canvas2 = document.getElementById('signatureCanvas2');

            ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
            ctx2.clearRect(0, 0, canvas2.width, canvas2.height);

            document.getElementById('ph1').classList.remove('hidden');
            document.getElementById('ph2').classList.remove('hidden');
        }

        // Generar PDF con formato similar al documento original
        function generarPDF() {
            // Validar formularios
            const forms = document.querySelectorAll('form');
            let isValid = true;

            forms.forEach(form => {
                if (!form.checkValidity()) {
                    isValid = false;
                    // Marcar campos inválidos
                    form.querySelectorAll(':invalid').forEach(input => {
                        input.style.borderColor = '#dc2626';
                    });
                }
            });

            if (!isValid) {
                alert('Por favor complete todos los campos requeridos correctamente.');
                return;
            }

            // Verificar si hay firmas
            const canvas1 = document.getElementById('signatureCanvas1');
            const canvas2 = document.getElementById('signatureCanvas2');

            const ctx1 = canvas1.getContext('2d');
            const ctx2 = canvas2.getContext('2d');

            const imageData1 = ctx1.getImageData(0, 0, canvas1.width, canvas1.height);
            const imageData2 = ctx2.getImageData(0, 0, canvas2.width, canvas2.height);

            let isEmpty1 = true;
            let isEmpty2 = true;

            for (let i = 0; i < imageData1.data.length; i += 4) {
                if (imageData1.data[i + 3] !== 0) {
                    isEmpty1 = false;
                    break;
                }
            }

            for (let i = 0; i < imageData2.data.length; i += 4) {
                if (imageData2.data[i + 3] !== 0) {
                    isEmpty2 = false;
                    break;
                }
            }

            if (isEmpty1 || isEmpty2) {
                alert('Por favor firme ambos documentos antes de generar el PDF.');
                return;
            }

            // Crear PDF
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();

            // PRIMERA PÁGINA - SOLICITUD
            doc.setFontSize(16);
            doc.setTextColor(15, 118, 110);
            doc.text('Instituto de Educación Superior Tecnológico Público', pageWidth / 2, 20, { align: 'center' });
            doc.text('María Rosario Araoz Pinto', pageWidth / 2, 26, { align: 'center' });

            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('SR. DIRECTOR DEL IESTP. "MARIA ROSARIO ARAOZ PINTO"', 20, 40);

            let yPos = 50;

            // Datos del postulante
            doc.setFontSize(11);
            doc.text(`APELLIDO PATERNO: ${document.getElementById('apellidoPaterno').value}`, 20, yPos);
            doc.text(`APELLIDO MATERNO: ${document.getElementById('apellidoMaterno').value}`, 110, yPos);
            yPos += 8;

            doc.text(`NOMBRES: ${document.getElementById('nombresSolicitud').value}`, 20, yPos);
            yPos += 8;

            doc.text(`DOCUMENTO DE IDENTIDAD: ${document.getElementById('dniSolicitud').value}`, 20, yPos);
            doc.text(`DOMICILIO ACTUAL: ${document.getElementById('domicilioSolicitud').value}`, 110, yPos);
            yPos += 12;

            // Texto de la solicitud
            doc.setFont(undefined, 'bold');
            doc.text('ANTE UD., ME PRESENTO Y EXPONGO:', 20, yPos);
            yPos += 8;

            doc.setFont(undefined, 'normal');
            doc.text('Declaro cumplir con los requisitos establecidos en el Reglamento de', 20, yPos);
            yPos += 5;
            doc.text('Admisión, para mi postulación.', 20, yPos);
            yPos += 5;
            doc.text('Que acato en todos sus términos el Reglamento de Admisión.', 20, yPos);
            yPos += 8;

            doc.text('Por tanto solicito a Ud., señor Director, se sirva disponer mi inscripción como', 20, yPos);
            yPos += 5;
            doc.text('postulante a la Especialidad de:', 20, yPos);
            yPos += 8;

            doc.text(`Especialidad: ${document.getElementById('especialidad').value}`, 20, yPos);
            yPos += 8;

            doc.text(`Turno: ${document.getElementById('turno').value}`, 20, yPos);
            doc.text(`Modalidad: ${document.getElementById('modalidad').value}`, 110, yPos);
            yPos += 8;

            const anioReglamento = document.getElementById('anioReglamento').value || '20......';
            doc.text(`Adjunto a la presente los documentos solicitados por el Reglamento de ADMISIÓN ${anioReglamento}`, 20, yPos);
            yPos += 15;

            // Fecha
            const dia = document.getElementById('dia').value || '......';
            const mes = document.getElementById('mes').value || '......';
            const anio = document.getElementById('anio').value || '20......';
            doc.text(`San Miguel, ${dia} de ${mes} del ${anio}`, pageWidth - 20, yPos, { align: 'right' });
            yPos += 15;

            // Firma
            doc.setFont(undefined, 'bold');
            doc.text('FIRMA DEL POSTULANTE', 20, yPos);
            yPos += 8;

            // Convertir canvas a imagen y agregar al PDF
            const firma1 = canvas1.toDataURL('image/png');
            doc.addImage(firma1, 'PNG', 20, yPos, 80, 40);

            // SEGUNDA PÁGINA - ACTA DE COMPROMISO
            doc.addPage();
            yPos = 20;

            doc.setFontSize(16);
            doc.setTextColor(15, 118, 110);
            doc.text('Instituto de Educación Superior Tecnológico Público', pageWidth / 2, yPos, { align: 'center' });
            doc.text('María Rosario Araoz Pinto', pageWidth / 2, yPos + 6, { align: 'center' });

            yPos += 20;
            doc.setFontSize(18);
            doc.text('ACTA DE COMPROMISO', pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;

            // Texto del acta
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);

            const nombreActa = document.getElementById('nombreActa').value;
            const dniActa = document.getElementById('dniActa').value;
            const calleActa = document.getElementById('calleActa').value;
            const distritoActa = document.getElementById('distritoActa').value;
            const anioReglamentoActa = document.getElementById('anioReglamentoActa').value || '20......';

            doc.text(`Yo, ${nombreActa} identificado con D.N.I. N° ${dniActa} domiciliado en la Av., Jr., Calle N°`, 20, yPos);
            yPos += 6;
            doc.text(`${calleActa} ${distritoActa}`, 20, yPos);
            yPos += 10;

            const actaText = `mediante la presente Acta me comprometo completar mi CARPETA DE POSTULANTE de acuerdo a los requisitos solicitados por el REGLAMENTO DE ADMISIÓN ${anioReglamentoActa} del IESTP "MARIA ROSARIO ARAOZ PINTO", dentro de 72 horas, después de haber sido publicado el cuadro de méritos correspondientes. De no cumplir con este requisito perderé la vacante obtenida en el concurso de admisión sin lugar a reclamos. Para dar fe a dicho compromiso, suscribo la presente Acta.`;

            const splitText = doc.splitTextToSize(actaText, pageWidth - 40);
            doc.text(splitText, 20, yPos);
            yPos += splitText.length * 6 + 10;

            // Fecha del acta
            const diaActa = document.getElementById('diaActa').value || '......';
            const mesActa = document.getElementById('mesActa').value || '......';
            const anioActa = document.getElementById('anioActa').value || '20......';
            doc.text(`San Miguel, ${diaActa} de ${mesActa} del ${anioActa}`, pageWidth - 20, yPos, { align: 'right' });
            yPos += 20;

            // Firma y huella
            doc.setFont(undefined, 'bold');
            doc.text('Huella Digital', 30, yPos);
            doc.text('Firma', pageWidth - 50, yPos);
            yPos += 40;

            doc.setFont(undefined, 'normal');
            doc.text('Índice derecho', 30, yPos);

            // Convertir segundo canvas a imagen
            const firma2 = canvas2.toDataURL('image/png');
            doc.addImage(firma2, 'PNG', pageWidth - 70, yPos - 35, 50, 30);

            const dniFirma = document.getElementById('dniFirma').value || '......';
            doc.text(`DNI. N° ${dniFirma}`, pageWidth - 50, yPos);

            // Guardar PDF
            const nombreArchivo = `solicitud_${document.getElementById('dniSolicitud').value}_${Date.now()}.pdf`;
            doc.save(nombreArchivo);
        }

        // Inicializar cuando se cargue la página
        window.addEventListener('DOMContentLoaded', () => {
            initCanvas();

            // Configurar botones
            document.getElementById('limpiarBtn').addEventListener('click', limpiarFirmas);
            document.getElementById('generarPdfBtn').addEventListener('click', generarPDF);

            // Restablecer bordes de inputs cuando se corrige
            document.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('input', function () {
                    this.style.borderColor = '#e2e8f0';
                });
            });

            // Ajustar canvas al redimensionar ventana
            window.addEventListener('resize', () => {
                setTimeout(initCanvas, 100);
            });
        });
    </script>
</body>

</html>