<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaraci칩n Jurada - IESTP Mar칤a Rosario Araoz Pinto</title>
    <link rel="stylesheet" href="CSS\debojurada.css">
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-line">
            <div>IESTP Mar칤a Rosario Araoz Pinto</div>
            <div>Ministerio de Educaci칩n</div>
        </div>

        <div class="institution-name">
            INSTITUTO DE EDUCACI칍N SUPERIOR TECNOL칍GICO P칔BLICO<br>
            MAR칈A ROSARIO ARAOZ PINTO
        </div>

        <h1 class="main-title">DECLARACI칍N JURADA</h1>
        <h2 class="subtitle">DE DOCUMENTOS (POSTULANTE MAYOR DE EDAD)</h2>
    </div>

    <div class="app-container">
        <div class="controls-panel">
            <h2 class="controls-title">Completar Declaraci칩n Jurada</h2>
            
            <div id="alertMessage" class="alert"></div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre">Apellidos y Nombres:</label>
                    <input type="text" id="nombre" placeholder="Ingrese apellidos y nombres completos">
                </div>
                
                <div class="form-group">
                    <label for="dni">DNI o Carn칠 de Extranjer칤a:</label>
                    <input type="text" id="dni" placeholder="Ingrese n칰mero de documento">
                </div>
                
                <div class="form-group">
                    <label for="domicilio">Domicilio:</label>
                    <input type="text" id="domicilio" placeholder="Ingrese domicilio completo">
                </div>
                
                <div class="form-group">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha">
                </div>
                
                <!-- Secci칩n de firma virtual -->
                <div class="signature-section">
                    <div class="signature-header">
                        <span>九꽲잺 Firma Virtual</span>
                        <div class="signature-buttons">
                            <button onclick="limpiarFirma()" type="button" class="btn-clear">Limpiar</button>
                            <button onclick="guardarFirma()" type="button" class="btn-save">Guardar</button>
                        </div>
                    </div>
                    
                    <div class="signature-container">
                        <canvas id="signatureCanvas" width="400" height="150"></canvas>
                        <div class="signature-instructions">
                            Dibuje su firma en el 치rea superior
                        </div>
                    </div>
                    
                    <div id="signaturePreview" class="signature-preview-container" style="display: none;">
                        <div class="signature-preview-label">Firma guardada:</div>
                        <img id="signatureImage" class="signature-preview-img" alt="Vista previa de firma">
                    </div>
                </div>
                
                <div class="fingerprint-section" id="fingerprintArea">
                    <div>游닝 Subir Huella Digital (칈ndice Derecho)</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Arrastre una imagen aqu칤 o haga clic para seleccionar
                    </div>
                    <input type="file" id="fingerprintFile" accept="image/*" style="display: none;">
                    <img id="fingerprintPreview" class="fingerprint-preview" alt="Vista previa huella">
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn-primary" onclick="actualizarVistaPrevia()">Actualizar Vista</button>
                <button class="btn-success" onclick="generarPDF()">Generar PDF</button>
                <button onclick="imprimirDocumento()">Imprimir</button>
                <button onclick="limpiarFormulario()">Limpiar Todo</button>
            </div>
        </div>
        
        <div class="pdf-preview-container">
            <h3 style="text-align: center; margin-bottom: 15px;">Vista Previa del Documento</h3>
            
            <!-- P치gina 1 -->
            <div class="pdf-page">
                <div class="pdf-title">DECLARACI칍N JURADA</div>
                <div class="pdf-subtitle">DE DOCUMENTOS</div>
                <div class="pdf-minor-title">(POSTULANTE MAYOR DE EDAD)</div>
                
                <div class="pdf-institution">
                    El Instituto de Educaci칩n Superior Tecnol칩gico P칰blico Mar칤a Rosario<br>
                    Araoz Pinto establece la siguiente declaraci칩n jurada en el marco de la<br>
                    LEY N.춿 30512 DE INSTITUTOS Y ESCUELAS DE EDUCACI칍N<br>
                    SUPERIOR Y DE LA CARRERA P칔BLICA DE SUS DOCENTES y el<br>
                    art칤culo 411춿 del C칩digo Penal.
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">Yo,</div>
                    <div class="pdf-field" id="previewNombre">_________________________</div>
                    <div class="pdf-note">identificado (a)</div>
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">domiciliado (a) en</div>
                    <div class="pdf-field" id="previewDomicilio">_________________________</div>
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">con N.춿</div>
                    <div class="pdf-field" id="previewDni">_________________________</div>
                    <div class="pdf-note">DECLARO BAJO JURAMENTO QUE:</div>
                </div>
                
                <div class="pdf-declaration-text">
                    <strong>I. Al estar cociente del pago realizado por el derecho de examen de admisi칩n y</strong><br>
                    prospecto, tener conocimiento de la no devoluci칩n del deposito realizado,<br>
                    acepto no realizar el pedido de la devoluci칩n del mismo, por cualquier<br>
                    motivo.
                </div>
                
                <div class="pdf-declaration-text">
                    Autorizo al IESTP Mar칤a Rosario Araoz Pinto la verificaci칩n de la presente<br>
                    DECLARACI칍N JURADA, asumiendo la responsabilidad civil y/o penal de<br>
                    comprobarse la falsedad de la informaci칩n registrada al momento de mi<br>
                    inscripci칩n. De faltar a la verdad en esta declaraci칩n me sujeto a los alcances<br>
                    de lo establecido en el art칤culo 411춿 del C칩digo Penal<sup>1</sup> y acepto la anulaci칩n del<br>
                    examen de admisi칩n del IESTP Mar칤a Rosario Araoz Pinto, sin lugar a reclamo.
                </div>
                
                <div class="pdf-date" id="previewFecha">
                    Lima, ____ de _______________ de ____
                </div>
                
                <!-- 츼rea para mostrar firma virtual en el PDF -->
                <div class="pdf-signature-area">
                    <div class="pdf-signature-label">Firma del Declarante:</div>
                    <div class="pdf-signature-box">
                        <img id="previewSignatureImg" class="pdf-signature-img" style="display: none;">
                        <div id="noSignatureText" style="color: #999; font-style: italic; padding: 20px;">
                            [츼rea para firma]
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <div class="pdf-footer-label">Apellidos y Nombres:</div>
                    <div class="pdf-footer-field" id="previewFirmaNombre">_________________________</div>
                </div>
            </div>
            
            <!-- P치gina 2 -->
            <div class="pdf-page pdf-page-2">
                <div class="pdf-form-line pdf-dni-field">
                    <div class="pdf-label">D.N.I. o Carn칠 de Extranjer칤a:</div>
                    <div class="pdf-field" id="previewDni2">_________________________</div>
                </div>
                
                <div class="pdf-fingerprint-area">
                    <div class="pdf-fingerprint-label">Huella digital</div>
                    <div class="pdf-fingerprint-box">
                        <span id="fingerprintText">칈ndice Derecho</span>
                        <img id="previewFingerprintImg" class="pdf-fingerprint-img" style="display: none;">
                    </div>
                </div>
                
                <div class="pdf-legal-reference">
                    <sup>1</sup> Art칤culo 411춿.- El que, en un procedimiento administrativo, hace una falsa declaraci칩n en relaci칩n a hechos o circunstancias que le corresponde probar, violando la presunci칩n de veracidad establecida por ley, ser치 reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro a침os.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let fingerprintImage = null;
        let signatureImage = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        const meses = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        
        // Inicializaci칩n
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fecha actual por defecto
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Inicializar canvas para firma
            inicializarCanvasFirma();
            
            // Configurar eventos para huella digital
            const fingerprintFile = document.getElementById('fingerprintFile');
            const fingerprintArea = document.getElementById('fingerprintArea');
            
            fingerprintArea.addEventListener('click', function() {
                fingerprintFile.click();
            });
            
            fingerprintFile.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    handleFingerprintImage(e.target.files[0]);
                }
            });
            
            // Drag and drop para huella digital
            fingerprintArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                fingerprintArea.style.backgroundColor = '#e8f4fd';
            });
            
            fingerprintArea.addEventListener('dragleave', function() {
                fingerprintArea.style.backgroundColor = '';
            });
            
            fingerprintArea.addEventListener('drop', function(e) {
                e.preventDefault();
                fingerprintArea.style.backgroundColor = '';
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFingerprintImage(e.dataTransfer.files[0]);
                }
            });
            
            // Actualizar vista previa inicial
            actualizarVistaPrevia();
        });
        
        // Inicializar canvas para firma
        function inicializarCanvasFirma() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar canvas
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Eventos del mouse
            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });
            
            canvas.addEventListener('mousemove', dibujar);
            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseout', () => isDrawing = false);
            
            // Eventos t치ctiles (para dispositivos m칩viles)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                isDrawing = true;
                [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                if (isDrawing) {
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    [lastX, lastY] = [x, y];
                }
            });
            
            canvas.addEventListener('touchend', () => isDrawing = false);
        }
        
        // Funci칩n para dibujar en el canvas
        function dibujar(e) {
            if (!isDrawing) return;
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }
        
        // Guardar firma
        function guardarFirma() {
            const canvas = document.getElementById('signatureCanvas');
            
            // Verificar si hay algo dibujado
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasDrawing = false;
            
            for (let i = 3; i < imageData.data.length; i += 4) {
                if (imageData.data[i] > 0) {
                    hasDrawing = true;
                    break;
                }
            }
            
            if (!hasDrawing) {
                mostrarAlerta('Por favor, dibuje su firma primero', 'error');
                return;
            }
            
            // Convertir canvas a imagen
            signatureImage = canvas.toDataURL('image/png');
            
            // Mostrar vista previa de la firma
            const previewContainer = document.getElementById('signaturePreview');
            const previewImg = document.getElementById('signatureImage');
            
            previewImg.src = signatureImage;
            previewContainer.style.display = 'block';
            
            // Actualizar vista previa del documento
            actualizarVistaPrevia();
            
            mostrarAlerta('Firma guardada correctamente', 'success');
        }
        
        // Limpiar firma
        function limpiarFirma() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ocultar vista previa
            document.getElementById('signaturePreview').style.display = 'none';
            signatureImage = null;
            
            // Actualizar vista previa del documento
            actualizarVistaPrevia();
            
            mostrarAlerta('Firma limpiada', 'success');
        }
        
        // Manejar imagen de huella digital
        function handleFingerprintImage(file) {
            if (!file.type.match('image.*')) {
                mostrarAlerta('Por favor, seleccione una imagen v치lida (JPG, PNG)', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB m치ximo
                mostrarAlerta('La imagen es muy grande. M치ximo 5MB.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                fingerprintImage = e.target.result;
                
                // Mostrar vista previa
                const preview = document.getElementById('fingerprintPreview');
                preview.src = fingerprintImage;
                preview.style.display = 'block';
                
                // Actualizar vista previa del documento
                actualizarVistaPrevia();
                
                mostrarAlerta('Huella digital cargada correctamente', 'success');
            };
            
            reader.readAsDataURL(file);
        }
        
        // Mostrar alerta
        function mostrarAlerta(mensaje, tipo = 'success') {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = mensaje;
            alertDiv.className = `alert alert-${tipo}`;
            alertDiv.style.display = 'block';
            
            setTimeout(function() {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // Actualizar vista previa del documento
        function actualizarVistaPrevia() {
            // Obtener valores
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            const domicilio = document.getElementById('domicilio').value.trim();
            const fecha = document.getElementById('fecha').value;
            
            // Actualizar campos en vista previa
            const previewNombre = document.getElementById('previewNombre');
            const previewDni = document.getElementById('previewDni');
            const previewDni2 = document.getElementById('previewDni2');
            const previewDomicilio = document.getElementById('previewDomicilio');
            const previewFirmaNombre = document.getElementById('previewFirmaNombre');
            const previewFecha = document.getElementById('previewFecha');
            
            // Actualizar nombre
            if (nombre) {
                previewNombre.textContent = nombre;
                previewNombre.className = 'pdf-field filled';
                previewFirmaNombre.textContent = nombre;
                previewFirmaNombre.className = 'pdf-footer-field filled';
            } else {
                previewNombre.textContent = '_________________________';
                previewNombre.className = 'pdf-field';
                previewFirmaNombre.textContent = '_________________________';
                previewFirmaNombre.className = 'pdf-footer-field';
            }
            
            // Actualizar DNI
            if (dni) {
                previewDni.textContent = dni;
                previewDni.className = 'pdf-field filled';
                previewDni2.textContent = dni;
                previewDni2.className = 'pdf-field filled';
            } else {
                previewDni.textContent = '_________________________';
                previewDni.className = 'pdf-field';
                previewDni2.textContent = '_________________________';
                previewDni2.className = 'pdf-field';
            }
            
            // Actualizar domicilio
            if (domicilio) {
                previewDomicilio.textContent = domicilio;
                previewDomicilio.className = 'pdf-field filled';
            } else {
                previewDomicilio.textContent = '_________________________';
                previewDomicilio.className = 'pdf-field';
            }
            
            // Actualizar fecha
            let fechaTexto = 'Lima, ____ de _______________ de ____';
            if (fecha) {
                const fechaObj = new Date(fecha);
                const dia = fechaObj.getDate();
                const mes = meses[fechaObj.getMonth()];
                const anio = fechaObj.getFullYear();
                fechaTexto = `Lima, ${dia} de ${mes} de ${anio}`;
            }
            previewFecha.textContent = fechaTexto;
            
            // Actualizar huella digital
            const fingerprintImg = document.getElementById('previewFingerprintImg');
            const fingerprintText = document.getElementById('fingerprintText');
            
            if (fingerprintImage) {
                fingerprintImg.src = fingerprintImage;
                fingerprintImg.style.display = 'block';
                fingerprintText.style.display = 'none';
            } else {
                fingerprintImg.style.display = 'none';
                fingerprintText.style.display = 'block';
            }
            
            // Actualizar firma virtual
            const signatureImg = document.getElementById('previewSignatureImg');
            const noSignatureText = document.getElementById('noSignatureText');
            
            if (signatureImage) {
                signatureImg.src = signatureImage;
                signatureImg.style.display = 'block';
                noSignatureText.style.display = 'none';
            } else {
                signatureImg.style.display = 'none';
                noSignatureText.style.display = 'block';
            }
            
            mostrarAlerta('Vista previa actualizada', 'success');
        }
        
        // Generar PDF
        async function generarPDF() {
            // Validar datos m칤nimos
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            
            if (!nombre || !dni) {
                mostrarAlerta('Por favor, complete al menos el nombre y DNI', 'error');
                return;
            }
            
            if (!signatureImage) {
                if (!confirm('No se ha guardado una firma. 쮻esea continuar sin firma?')) {
                    return;
                }
            }
            
            mostrarAlerta('Generando PDF... Esto puede tomar unos segundos.', 'success');
            
            try {
                // Capturar ambas p치ginas
                const pages = document.querySelectorAll('.pdf-page');
                
                // Crear PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: [794, 1123] // Tama침o exacto de A4 en pixeles
                });
                
                // Configuraci칩n
                pdf.setFont('helvetica');
                pdf.setFontSize(11);
                
                // Generar cada p치gina
                for (let i = 0; i < pages.length; i++) {
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    const canvas = await html2canvas(pages[i], {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: '#ffffff',
                        logging: false
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    
                    // Calcular dimensiones para ajustar a la p치gina
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    
                    // A침adir imagen al PDF
                    pdf.addImage(imgData, 'JPEG', 0, 0, pageWidth, pageHeight);
                }
                
                // Guardar PDF
                const nombreArchivo = `Declaracion_Jurada_${dni}_${nombre.replace(/\s+/g, '_')}.pdf`;
                pdf.save(nombreArchivo);
                
                mostrarAlerta('PDF generado y descargado correctamente', 'success');
                
            } catch (error) {
                console.error('Error al generar PDF:', error);
                mostrarAlerta('Error al generar el PDF. Intente nuevamente.', 'error');
            }
        }
        
        // Imprimir documento
        function imprimirDocumento() {
            // Validar datos m칤nimos
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            
            if (!nombre || !dni) {
                mostrarAlerta('Complete nombre y DNI antes de imprimir', 'error');
                return;
            }
            
            if (!signatureImage) {
                if (!confirm('No se ha guardado una firma. 쮻esea imprimir sin firma?')) {
                    return;
                }
            }
            
            window.print();
        }
        
        // Limpiar formulario completo
        function limpiarFormulario() {
            if (confirm('쮼st치 seguro de limpiar todos los datos incluyendo firma y huella digital?')) {
                document.getElementById('nombre').value = '';
                document.getElementById('dni').value = '';
                document.getElementById('domicilio').value = '';
                document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
                
                // Limpiar huella digital
                fingerprintImage = null;
                document.getElementById('fingerprintFile').value = '';
                document.getElementById('fingerprintPreview').style.display = 'none';
                document.getElementById('fingerprintPreview').src = '';
                
                // Limpiar firma
                limpiarFirma();
                
                actualizarVistaPrevia();
                mostrarAlerta('Formulario limpiado completamente', 'success');
            }
        }
    </script>

    <style>
        /* Estilos adicionales para la firma virtual */
        .signature-section {
            grid-column: span 2;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }
        
        .signature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .signature-buttons {
            display: flex;
            gap: 8px;
        }
        
        .signature-buttons button {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-clear {
            background-color: #ff6b6b;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #ff5252;
        }
        
        .btn-save {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #45a049;
        }
        
        .signature-container {
            position: relative;
            border: 2px dashed #ccc;
            border-radius: 6px;
            background-color: white;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        #signatureCanvas {
            display: block;
            width: 100%;
            height: 150px;
            cursor: crosshair;
            background-color: white;
        }
        
        .signature-instructions {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            text-align: center;
            color: #999;
            font-size: 12px;
            pointer-events: none;
        }
        
        .signature-preview-container {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            background-color: white;
            margin-top: 10px;
        }
        
        .signature-preview-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .signature-preview-img {
            max-width: 100%;
            max-height: 80px;
            border: 1px solid #eee;
        }
        
        /* Estilos para la firma en el PDF */
        .pdf-signature-area {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .pdf-signature-label {
            font-size: 12px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .pdf-signature-box {
            border: 1px solid #999;
            border-radius: 4px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f8f8;
        }
        
        .pdf-signature-img {
            max-width: 90%;
            max-height: 70px;
        }
        
        /* Estilos para los campos llenados */
        .pdf-field.filled, .pdf-footer-field.filled {
            font-weight: bold;
            color: #000;
            text-decoration: underline;
        }
        
        /* Ajustes responsivos */
        @media (max-width: 768px) {
            .signature-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .signature-buttons {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</body>
</html>