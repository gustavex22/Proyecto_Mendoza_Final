<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaraci칩n Jurada - IESTP Mar칤a Rosario Araoz Pinto</title>
    <link rel="stylesheet" href="CSS\debojurada.css">
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-line">
            <div>IESTP Mar칤a Rosario Araoz Pinto</div>
            <div>Ministerio de Educaci칩n</div>
        </div>

        <div class="institution-name">
            INSTITUTO DE EDUCACI칍N SUPERIOR TECNOL칍GICO P칔BLICO<br>
            MAR칈A ROSARIO ARAOZ PINTO
        </div>

        <h1 class="main-title">DECLARACI칍N JURADA</h1>
        <h2 class="subtitle">DE DOCUMENTOS (POSTULANTE MAYOR DE EDAD)</h2>
    </div>

    <div class="app-container">
        <div class="controls-panel">
            <h2 class="controls-title">Completar Declaraci칩n Jurada</h2>
            
            <div id="alertMessage" class="alert"></div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre">Apellidos y Nombres:</label>
                    <input type="text" id="nombre" placeholder="Ingrese apellidos y nombres completos">
                </div>
                
                <div class="form-group">
                    <label for="dni">DNI o Carn칠 de Extranjer칤a:</label>
                    <input type="text" id="dni" placeholder="Ingrese n칰mero de documento">
                </div>
                
                <div class="form-group">
                    <label for="domicilio">Domicilio:</label>
                    <input type="text" id="domicilio" placeholder="Ingrese domicilio completo">
                </div>
                
                <div class="form-group">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha">
                </div>
                
                <div class="fingerprint-section" id="fingerprintArea">
                    <div>游닝 Subir Huella Digital (칈ndice Derecho)</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Arrastre una imagen aqu칤 o haga clic para seleccionar
                    </div>
                    <input type="file" id="fingerprintFile" accept="image/*" style="display: none;">
                    <img id="fingerprintPreview" class="fingerprint-preview" alt="Vista previa huella">
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn-primary" onclick="actualizarVistaPrevia()">Actualizar Vista</button>
                <button class="btn-success" onclick="generarPDF()">Generar PDF</button>
                <button onclick="imprimirDocumento()">Imprimir</button>
                <button onclick="limpiarFormulario()">Limpiar</button>
            </div>
        </div>
        
        <div class="pdf-preview-container">
            <h3 style="text-align: center; margin-bottom: 15px;">Vista Previa del Documento</h3>
            
            <!-- P치gina 1 -->
            <div class="pdf-page">
                <div class="pdf-title">DECLARACI칍N JURADA</div>
                <div class="pdf-subtitle">DE DOCUMENTOS</div>
                <div class="pdf-minor-title">(POSTULANTE MAYOR DE EDAD)</div>
                
                <div class="pdf-institution">
                    El Instituto de Educaci칩n Superior Tecnol칩gico P칰blico Mar칤a Rosario<br>
                    Araoz Pinto establece la siguiente declaraci칩n jurada en el marco de la<br>
                    LEY N.춿 30512 DE INSTITUTOS Y ESCUELAS DE EDUCACI칍N<br>
                    SUPERIOR Y DE LA CARRERA P칔BLICA DE SUS DOCENTES y el<br>
                    art칤culo 411춿 del C칩digo Penal.
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">Yo,</div>
                    <div class="pdf-field" id="previewNombre">_________________________</div>
                    <div class="pdf-note">identificado (a)</div>
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">domiciliado (a) en</div>
                    <div class="pdf-field" id="previewDomicilio">_________________________</div>
                </div>
                
                <div class="pdf-form-line">
                    <div class="pdf-label">con N.춿</div>
                    <div class="pdf-field" id="previewDni">_________________________</div>
                    <div class="pdf-note">DECLARO BAJO JURAMENTO QUE:</div>
                </div>
                
                <div class="pdf-declaration-text">
                    <strong>I. Al estar cociente del pago realizado por el derecho de examen de admisi칩n y</strong><br>
                    prospecto, tener conocimiento de la no devoluci칩n del deposito realizado,<br>
                    acepto no realizar el pedido de la devoluci칩n del mismo, por cualquier<br>
                    motivo.
                </div>
                
                <div class="pdf-declaration-text">
                    Autorizo al IESTP Mar칤a Rosario Araoz Pinto la verificaci칩n de la presente<br>
                    DECLARACI칍N JURADA, asumiendo la responsabilidad civil y/o penal de<br>
                    comprobarse la falsedad de la informaci칩n registrada al momento de mi<br>
                    inscripci칩n. De faltar a la verdad en esta declaraci칩n me sujeto a los alcances<br>
                    de lo establecido en el art칤culo 411춿 del C칩digo Penal<sup>1</sup> y acepto la anulaci칩n del<br>
                    examen de admisi칩n del IESTP Mar칤a Rosario Araoz Pinto, sin lugar a reclamo.
                </div>
                
                <div class="pdf-date" id="previewFecha">
                    Lima, ____ de _______________ de ____
                </div>
                
                <div class="pdf-signature-line"></div>
                <div class="pdf-label">Firma</div>
                
                <div style="margin-top: 30px;">
                    <div class="pdf-footer-label">Apellidos y Nombres:</div>
                    <div class="pdf-footer-field" id="previewFirmaNombre">_________________________</div>
                </div>
            </div>
            
            <!-- P치gina 2 -->
            <div class="pdf-page pdf-page-2">
                <div class="pdf-form-line pdf-dni-field">
                    <div class="pdf-label">D.N.I. o Carn칠 de Extranjer칤a:</div>
                    <div class="pdf-field" id="previewDni2">_________________________</div>
                </div>
                
                <div class="pdf-fingerprint-area">
                    <div class="pdf-fingerprint-label">Huella digital</div>
                    <div class="pdf-fingerprint-box">
                        <span id="fingerprintText">칈ndice Derecho</span>
                        <img id="previewFingerprintImg" class="pdf-fingerprint-img" style="display: none;">
                    </div>
                </div>
                
                <div class="pdf-legal-reference">
                    <sup>1</sup> Art칤culo 411춿.- El que, en un procedimiento administrativo, hace una falsa declaraci칩n en relaci칩n a hechos o circunstancias que le corresponde probar, violando la presunci칩n de veracidad establecida por ley, ser치 reprimido con pena privativa de libertad no menor de uno ni mayor de cuatro a침os.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let fingerprintImage = null;
        const meses = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        
        // Inicializaci칩n
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fecha actual por defecto
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Configurar eventos para huella digital
            const fingerprintFile = document.getElementById('fingerprintFile');
            const fingerprintArea = document.getElementById('fingerprintArea');
            
            fingerprintArea.addEventListener('click', function() {
                fingerprintFile.click();
            });
            
            fingerprintFile.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    handleFingerprintImage(e.target.files[0]);
                }
            });
            
            // Drag and drop para huella digital
            fingerprintArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                fingerprintArea.style.backgroundColor = '#e8f4fd';
            });
            
            fingerprintArea.addEventListener('dragleave', function() {
                fingerprintArea.style.backgroundColor = '';
            });
            
            fingerprintArea.addEventListener('drop', function(e) {
                e.preventDefault();
                fingerprintArea.style.backgroundColor = '';
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFingerprintImage(e.dataTransfer.files[0]);
                }
            });
            
            // Actualizar vista previa inicial
            actualizarVistaPrevia();
        });
        
        // Manejar imagen de huella digital
        function handleFingerprintImage(file) {
            if (!file.type.match('image.*')) {
                mostrarAlerta('Por favor, seleccione una imagen v치lida (JPG, PNG)', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB m치ximo
                mostrarAlerta('La imagen es muy grande. M치ximo 5MB.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                fingerprintImage = e.target.result;
                
                // Mostrar vista previa
                const preview = document.getElementById('fingerprintPreview');
                preview.src = fingerprintImage;
                preview.style.display = 'block';
                
                // Actualizar vista previa del documento
                actualizarVistaPrevia();
                
                mostrarAlerta('Huella digital cargada correctamente', 'success');
            };
            
            reader.readAsDataURL(file);
        }
        
        // Mostrar alerta
        function mostrarAlerta(mensaje, tipo = 'success') {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = mensaje;
            alertDiv.className = `alert alert-${tipo}`;
            alertDiv.style.display = 'block';
            
            setTimeout(function() {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // Actualizar vista previa del documento
        function actualizarVistaPrevia() {
            // Obtener valores
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            const domicilio = document.getElementById('domicilio').value.trim();
            const fecha = document.getElementById('fecha').value;
            
            // Actualizar campos en vista previa
            const previewNombre = document.getElementById('previewNombre');
            const previewDni = document.getElementById('previewDni');
            const previewDni2 = document.getElementById('previewDni2');
            const previewDomicilio = document.getElementById('previewDomicilio');
            const previewFirmaNombre = document.getElementById('previewFirmaNombre');
            const previewFecha = document.getElementById('previewFecha');
            
            // Actualizar nombre
            if (nombre) {
                previewNombre.textContent = nombre;
                previewNombre.className = 'pdf-field filled';
                previewFirmaNombre.textContent = nombre;
                previewFirmaNombre.className = 'pdf-footer-field filled';
            } else {
                previewNombre.textContent = '_________________________';
                previewNombre.className = 'pdf-field';
                previewFirmaNombre.textContent = '_________________________';
                previewFirmaNombre.className = 'pdf-footer-field';
            }
            
            // Actualizar DNI
            if (dni) {
                previewDni.textContent = dni;
                previewDni.className = 'pdf-field filled';
                previewDni2.textContent = dni;
                previewDni2.className = 'pdf-field filled';
            } else {
                previewDni.textContent = '_________________________';
                previewDni.className = 'pdf-field';
                previewDni2.textContent = '_________________________';
                previewDni2.className = 'pdf-field';
            }
            
            // Actualizar domicilio
            if (domicilio) {
                previewDomicilio.textContent = domicilio;
                previewDomicilio.className = 'pdf-field filled';
            } else {
                previewDomicilio.textContent = '_________________________';
                previewDomicilio.className = 'pdf-field';
            }
            
            // Actualizar fecha
            let fechaTexto = 'Lima, ____ de _______________ de ____';
            if (fecha) {
                const fechaObj = new Date(fecha);
                const dia = fechaObj.getDate();
                const mes = meses[fechaObj.getMonth()];
                const anio = fechaObj.getFullYear();
                fechaTexto = `Lima, ${dia} de ${mes} de ${anio}`;
            }
            previewFecha.textContent = fechaTexto;
            
            // Actualizar huella digital
            const fingerprintImg = document.getElementById('previewFingerprintImg');
            const fingerprintText = document.getElementById('fingerprintText');
            
            if (fingerprintImage) {
                fingerprintImg.src = fingerprintImage;
                fingerprintImg.style.display = 'block';
                fingerprintText.style.display = 'none';
            } else {
                fingerprintImg.style.display = 'none';
                fingerprintText.style.display = 'block';
            }
            
            mostrarAlerta('Vista previa actualizada', 'success');
        }
        
        // Generar PDF
        async function generarPDF() {
            // Validar datos m칤nimos
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            
            if (!nombre || !dni) {
                mostrarAlerta('Por favor, complete al menos el nombre y DNI', 'error');
                return;
            }
            
            mostrarAlerta('Generando PDF... Esto puede tomar unos segundos.', 'success');
            
            try {
                // Capturar ambas p치ginas
                const pages = document.querySelectorAll('.pdf-page');
                
                // Crear PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: [794, 1123] // Tama침o exacto de A4 en pixeles
                });
                
                // Configuraci칩n
                pdf.setFont('helvetica');
                pdf.setFontSize(11);
                
                // Generar cada p치gina
                for (let i = 0; i < pages.length; i++) {
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    const canvas = await html2canvas(pages[i], {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: '#ffffff',
                        logging: false
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    
                    // Calcular dimensiones para ajustar a la p치gina
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    
                    // A침adir imagen al PDF
                    pdf.addImage(imgData, 'JPEG', 0, 0, pageWidth, pageHeight);
                }
                
                // Guardar PDF
                const nombreArchivo = `Declaracion_Jurada_${dni}_${nombre.replace(/\s+/g, '_')}.pdf`;
                pdf.save(nombreArchivo);
                
                mostrarAlerta('PDF generado y descargado correctamente', 'success');
                
            } catch (error) {
                console.error('Error al generar PDF:', error);
                mostrarAlerta('Error al generar el PDF. Intente nuevamente.', 'error');
            }
        }
        
        // Imprimir documento
        function imprimirDocumento() {
            // Validar datos m칤nimos
            const nombre = document.getElementById('nombre').value.trim();
            const dni = document.getElementById('dni').value.trim();
            
            if (!nombre || !dni) {
                mostrarAlerta('Complete nombre y DNI antes de imprimir', 'error');
                return;
            }
            
            window.print();
        }
        
        // Limpiar formulario
        function limpiarFormulario() {
            if (confirm('쮼st치 seguro de limpiar todos los datos?')) {
                document.getElementById('nombre').value = '';
                document.getElementById('dni').value = '';
                document.getElementById('domicilio').value = '';
                document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
                
                // Limpiar huella digital
                fingerprintImage = null;
                document.getElementById('fingerprintFile').value = '';
                document.getElementById('fingerprintPreview').style.display = 'none';
                document.getElementById('fingerprintPreview').src = '';
                
                actualizarVistaPrevia();
                mostrarAlerta('Formulario limpiado', 'success');
            }
        }
    </script>
</body>
</html>